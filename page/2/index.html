<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>wiki</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="just like a wiki">
<meta name="keywords" content="wiki">
<meta property="og:type" content="website">
<meta property="og:title" content="wiki">
<meta property="og:url" content="https://jpcui.github.io/wiki/page/2/index.html">
<meta property="og:site_name" content="wiki">
<meta property="og:description" content="just like a wiki">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="wiki">
<meta name="twitter:description" content="just like a wiki">
  
    <link rel="alternate" href="/wiki/atom.xml" title="wiki" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/wiki/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/wiki/" id="logo">wiki</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/wiki/" id="subtitle">just like a wiki</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/wiki/">Home</a>
        
          <a class="main-nav-link" href="/wiki/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/wiki/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://jpcui.github.io/wiki"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-ã€phpã€‘å‚æ•°æ ¡éªŒ" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€phpã€‘å‚æ•°æ ¡éªŒ/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€phpã€‘å‚æ•°æ ¡éªŒ/">
                ã€phpã€‘å‚æ•°æ ¡éªŒ
            </a>
            
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;load-&gt;library(<span class="string">'form_validation'</span>);</span><br><span class="line"></span><br><span class="line">$data = [</span><br><span class="line">    <span class="string">'_id'</span> =&gt; <span class="keyword">$this</span>-&gt;input-&gt;get(<span class="string">"_id"</span>),</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="keyword">$this</span>-&gt;input-&gt;get(<span class="string">"name"</span>),</span><br><span class="line">    <span class="string">'covers'</span> =&gt; <span class="keyword">$this</span>-&gt;input-&gt;get(<span class="string">"covers"</span>),</span><br><span class="line">];</span><br><span class="line"><span class="comment">// å°†è¦éªŒè¯çš„å‚æ•° set è¿›å»</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;form_validation-&gt;set_data($data);</span><br><span class="line"></span><br><span class="line"><span class="comment">// validate</span></span><br><span class="line">$config = [[</span><br><span class="line">    <span class="string">'field'</span> =&gt; <span class="string">'_id'</span>,</span><br><span class="line">    <span class="string">'rules'</span> =&gt; <span class="string">'required'</span></span><br><span class="line">], [</span><br><span class="line">    <span class="string">'field'</span> =&gt; <span class="string">'name'</span>,</span><br><span class="line">    <span class="string">'rules'</span> =&gt; <span class="string">'required'</span></span><br><span class="line">], [</span><br><span class="line">    <span class="comment">// æ•°ç»„éœ€è¦åœ¨åé¢æˆ–ä¸¤è¾¹åŠ æ‹¬å·ï¼šcovers[] æˆ– [covers]</span></span><br><span class="line">    <span class="string">'field'</span> =&gt; <span class="string">'covers[]'</span>,</span><br><span class="line">    <span class="string">'label'</span> =&gt; <span class="string">'cover'</span>,</span><br><span class="line">    <span class="string">'rules'</span> =&gt; <span class="string">'required'</span></span><br><span class="line">]];</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;form_validation-&gt;set_rules($config);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;form_validation-&gt;run() === <span class="keyword">false</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;form_validation-&gt;error_array();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€phpã€‘å‚æ•°æ ¡éªŒ/" data-id="cjs2ln90e000gi3ui9nrpzydt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/php/">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€redisã€‘RedisTemplateçš„ä¸€ç‚¹ç–‘é—®" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€redisã€‘RedisTemplateçš„ä¸€ç‚¹ç–‘é—®/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€redisã€‘RedisTemplateçš„ä¸€ç‚¹ç–‘é—®/">
                ã€redisã€‘RedisTemplateçš„ä¸€ç‚¹ç–‘é—®
            </a>
            
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>æœ€è¿‘è€æ˜¯çœ‹åˆ° redis ä»poolé‡Œè·å–/é‡Šæ”¾çš„é¢‘ç¹æ“ä½œæ—¥å¿—, è·Ÿè¸ªä¸šåŠ¡å‘ç°, æ¯è°ƒç”¨ä¸€æ¬¡ RestTemplate.execute(callback), éƒ½ä¼šä»è¿æ¥æ± é‡Œè·å–jedisè¿æ¥</p>
<p>é¢‘ç¹è·å–å’Œé‡Šæ”¾è¿æ¥, ä¼šå¾ˆæµªè´¹èµ„æº.<br>åœ¨è·å–èµ„æºæ—¶, ä¼šç»è¿‡ä¸‹é¢å‡ ä¸ªæ“ä½œ:</p>
<ul>
<li>è·å–ç©ºé—²å¯¹è±¡(takeObject/pollObject)</li>
<li>æ¿€æ´»å¯¹è±¡(activateObject)</li>
<li>æ£€æŸ¥å¯¹è±¡æ˜¯å¦å¯ç”¨(testOnBorrow/testOnCreate/validateObject)</li>
<li>ä¿®æ”¹ç»Ÿè®¡çŠ¶æ€(updateStatsBorrow)</li>
</ul>
<p>é‡Šæ”¾èµ„æºæ—¶:</p>
<ul>
<li>æ£€æŸ¥å¯¹è±¡æ˜¯å¦å¯ç”¨(testOnReturn/validateObject)<ul>
<li>å¦‚æœä¸å¯ç”¨, é”€æ¯(destroy), ensureIdle(1, false)</li>
</ul>
</li>
<li>é’åŒ–å¯¹è±¡(passivateObject), æ„æ€å°±æ˜¯åˆšå¯¹è±¡åˆšè¢«ä½¿ç”¨è¿‡, è®©ä»–ä¼‘æ¯ä¸€ä¸‹</li>
<li>å½’è¿˜å¯¹è±¡(addFirst/addLast)</li>
<li>ä¿®æ”¹ç»Ÿè®¡çŠ¶æ€(updateStatsBorrow)</li>
</ul>
<p>å½“ç„¶ä½ å¯ä»¥æŠŠä¸šåŠ¡æ”¾åœ¨callbacké‡Œå¤„ç†, æ„Ÿè§‰åˆä¸å¤ªçˆ½, æ‰€ä»¥è¿˜æ˜¯æŠŠjedisé‡æ–°å°è£…ä¸€ä¸‹, æ¯•ç«Ÿ <a href="/oasis-ct/oasis-ct-core">oasis-ct-core</a> é‡Œå°è£…çš„ <a href="/oasis-ct/oasis-ct-core/src/master/src/main/java/cn/oasis/core/config/RedisConfiguration.java">RedisDao/RedisService</a> ä¹Ÿå¾ˆå·®, åºåˆ—åŒ–çš„æ–¹å¼ä½¿ç”¨çš„ä¹Ÿæ¯”è¾ƒä¹±.</p>
<p>è¿™é‡Œæ¥çœ‹ä¸‹rapçš„ä¸€ä¸ªissue, å€¼å¾—å€Ÿé‰´:<br><a href="https://github.com/thx/RAP/pull/1008" target="_blank" rel="noopener">https://github.com/thx/RAP/pull/1008</a><br>è§£å†³:<br><a href="https://github.com/thx/RAP/commit/ebd22f2b095b9cb6983a9945e5297a4ace9d439a" target="_blank" rel="noopener">https://github.com/thx/RAP/commit/ebd22f2b095b9cb6983a9945e5297a4ace9d439a</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€redisã€‘RedisTemplateçš„ä¸€ç‚¹ç–‘é—®/" data-id="cjs2ln90f000ii3ui0y9uw6op" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/redis/">redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/spring-data/">spring-data</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€spring-bootã€‘å¦‚ä½•ä¼˜é›…å…³é—­æœåŠ¡" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€spring-bootã€‘å¦‚ä½•ä¼˜é›…å…³é—­æœåŠ¡/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€spring-bootã€‘å¦‚ä½•ä¼˜é›…å…³é—­æœåŠ¡/">
                ã€spring-bootã€‘å¦‚ä½•ä¼˜é›…å…³é—­æœåŠ¡
            </a>
            
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å€ŸåŠ©-spring-boot"><a href="#å€ŸåŠ©-spring-boot" class="headerlink" title="å€ŸåŠ© spring-boot"></a>å€ŸåŠ© spring-boot</h2><p>å¼€å¯ä¼˜é›…å…³é—­ç»ˆç«¯ï¼š<code>endpoints.shutdown.enabled: true</code></p>
<p>è°ƒç”¨æ¥å£ï¼š <code>POST /shutdown</code></p>
<h2 id="ç”¨dockerå®ç°"><a href="#ç”¨dockerå®ç°" class="headerlink" title="ç”¨dockerå®ç°"></a>ç”¨dockerå®ç°</h2><ul>
<li><p>docker stop/restart [-t seconds] [container_id]</p>
<p>å‘é€ä¸­æ–­ä¿¡å·ï¼Œä¸ä¼šæ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œä¹‹å‰çš„è¯·æ±‚ä¼šç»§ç»­è¿è¡Œ</p>
<ul>
<li><p>æ–°è¯·æ±‚æ— æ³•åˆ›å»ºè¿æ¥ï¼šå› ä¸ºæœåŠ¡ä¸å†æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œæ‰€ä»¥ä¼šæŠ¥503ï¼šService Unavailableï¼Œ<br>å»ºè®®Clientè®¾ç½®ä¸€ä¸ªåˆé€‚çš„ <strong>è¿æ¥è¶…æ—¶æ—¶é—´</strong></p>
</li>
<li><p>è¶…æ—¶æ—¶é—´[-t]ï¼šåˆ°è¾¾è¶…æ—¶æ—¶é—´åï¼ŒæœåŠ¡ä»ä¼šç«‹å³ä¸­æ–­ï¼Œæ‰€ä»¥æœ€å¥½ <strong>è®¾ç½®ä¸€ä¸ªåˆé€‚çš„è¶…æ—¶æ—¶é—´</strong></p>
</li>
<li><p>æ—¥å¿—ï¼šæ¥æ”¶åˆ°ä¸­æ–­ä¿¡å·åï¼Œlogä¸ä¼šå†æ‰“å°ï¼Œä½† <code>log.isXXXEnabled()</code> ä»è¿”å› <code>true</code>ï¼<br>æ‰€ä»¥ä¸è¦ç”¨logä½œä¸ºåˆ¤æ–­è¯·æ±‚ä¸­æ–­çš„æ ‡è®°ï¼Œè€Œæ˜¯ç”¨<code>System.out.print</code></p>
</li>
</ul>
</li>
</ul>
<h2 id="ä»£ç è§£å†³"><a href="#ä»£ç è§£å†³" class="headerlink" title="ä»£ç è§£å†³"></a>ä»£ç è§£å†³</h2><blockquote>
<p>è¯¥æ–¹æ³•åªæ˜¯æ‰‹åŠ¨å…³é—­æœåŠ¡çº¿ç¨‹ï¼Œå‰å‡ ç§æ–¹æ³•å·²ç»å¯ä»¥åšåˆ°ï¼Œä¸å»ºè®®ä½¿ç”¨</p>
</blockquote>
<ul>
<li><p>å®ç°</p>
<p>è‡ªå®šä¹‰ <a href="#GracefulShutdownConfiguration"><code>GracefulShutdownConfiguration</code></a></p>
<p>é€šè¿‡ <code>@ImportAutoConfiguration(GracefulShutdownConfiguration.class)</code> å¯ç”¨é…ç½®</p>
</li>
<li><p>é—®é¢˜ï¼šåœæ­¢åæœåŠ¡ä»æœªå…³é—­ï¼Œç”¨<code>jstack</code>çœ‹åˆ°ä»ç„¶æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œï¼ˆåŸºäºæˆ‘å½“å‰çš„æœåŠ¡ï¼‰ï¼š</p>
<ul>
<li><p>org.springframework.cloud.consul.config.ConfigWatch</p>
<p>è§£å†³ï¼š<code>spring.cloud.consul.config.watch.enabled: false</code></p>
<p>ä½†æ˜¯æœ‰äº›æœåŠ¡æ˜¯éœ€è¦å¼€å¯çš„</p>
<p>æŸ¥çœ‹æºç ï¼Œè¯¥çº¿ç¨‹é»˜è®¤è¦ç­‰å¾…55sæ¥åˆ¤æ–­ç»“æŸçŠ¶æ€ï¼Œæ—¶é—´è¾ƒé•¿</p>
</li>
<li><p>ch.qos.logback.classic.AsyncAppender</p>
<p>è§£å†³ï¼šlogback-spring é‡ŒåŠ ä¸Š</p>
<p><code>&lt;shutdownHook class=&quot;ch.qos.logback.core.hook.DelayingShutdownHook&quot;/&gt;</code></p>
<p><code>ShutdownHookBase#close</code> é‡Œä¼šè°ƒç”¨ <code>Context.stop()</code> è¿›è¡Œå…³é—­</p>
</li>
</ul>
</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><p><a href="http://docs.api.xiaomi.com/app-engine-v2/bestpractice-pod-prestop.html" target="_blank" rel="noopener">åº”ç”¨ä¼˜é›…åœæ­¢æœ€ä½³å®è·µ</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/4e13db951895" target="_blank" rel="noopener">spring boot 2.0 å®ç°ä¼˜é›…åœæœº</a></p>
</li>
<li><p>spring boot issue: <a href="https://github.com/spring-projects/spring-boot/issues/4657" target="_blank" rel="noopener">Shut down embedded servlet container gracefully</a></p>
</li>
<li><p>A graceful shutdown starter for Spring-Boot: <a href="https://github.com/corentin59/spring-boot-graceful-shutdown" target="_blank" rel="noopener">spring-boot-graceful-shutdown</a></p>
</li>
<li><p>graceful shutdown by impl <code>TomcatConnectorCustomizer</code>: <a href="https://dzone.com/articles/graceful-shutdown-spring-boot-applications" target="_blank" rel="noopener">Graceful Shutdown Spring Boot Applications</a></p>
</li>
<li><p><a href="http://tech.lede.com/2017/07/31/rd/server/TomcatShutdownProblem/" target="_blank" rel="noopener">Tomcatåœæœºè¿‡ç¨‹åˆ†æåŠçº¿ç¨‹å¤„ç†æ–¹æ³•</a></p>
</li>
</ul>
<h2 id="GracefulShutdownConfiguration"><a href="#GracefulShutdownConfiguration" class="headerlink" title="GracefulShutdownConfiguration"></a>GracefulShutdownConfiguration</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GracefulShutdownConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GracefulShutdown <span class="title">gracefulShutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> GracefulShutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TomcatEmbeddedServletContainerFactory <span class="title">webServerFactory</span><span class="params">(<span class="keyword">final</span> GracefulShutdown gracefulShutdown)</span> </span>&#123;</span><br><span class="line">        TomcatEmbeddedServletContainerFactory factory = <span class="keyword">new</span> TomcatEmbeddedServletContainerFactory();</span><br><span class="line">        factory.addConnectorCustomizers(gracefulShutdown);</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">GracefulShutdown</span> <span class="keyword">implements</span> <span class="title">TomcatConnectorCustomizer</span>, <span class="title">ApplicationListener</span>&lt;<span class="title">ContextClosedEvent</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> Connector connector;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(Connector connector)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.connector = connector;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ContextClosedEvent event)</span> </span>&#123;</span><br><span class="line">            log.info(<span class="string">"signal: shutdown"</span>);</span><br><span class="line">            log.info(event.toString());</span><br><span class="line">            <span class="keyword">this</span>.connector.pause();</span><br><span class="line">            Executor executor = <span class="keyword">this</span>.connector.getProtocolHandler().getExecutor();</span><br><span class="line">            <span class="keyword">if</span> (executor <span class="keyword">instanceof</span> ThreadPoolExecutor) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ThreadPoolExecutor threadPoolExecutor = (ThreadPoolExecutor) executor;</span><br><span class="line">                    threadPoolExecutor.shutdown();</span><br><span class="line">                    log.info(threadPoolExecutor.getActiveCount() + <span class="string">""</span>);</span><br><span class="line">                    <span class="keyword">if</span> (!threadPoolExecutor.awaitTermination(<span class="number">30</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                        log.warn(<span class="string">"Tomcat thread pool did not shut down gracefully within "</span></span><br><span class="line">                            + <span class="string">"30 seconds. Proceeding with forceful shutdown"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€spring-bootã€‘å¦‚ä½•ä¼˜é›…å…³é—­æœåŠ¡/" data-id="cjs2ln90g000ki3uixlbix8ts" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/spring-boot/">spring-boot</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€spring-bootã€‘é…ç½®grafana" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€spring-bootã€‘é…ç½®grafana/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€spring-bootã€‘é…ç½®grafana/">
                ã€spring-bootã€‘é…ç½®grafana
            </a>
            
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="é¡¹ç›®é…ç½®-spring-boot-1-5-x"><a href="#é¡¹ç›®é…ç½®-spring-boot-1-5-x" class="headerlink" title="é¡¹ç›®é…ç½®(spring-boot:1.5.x)"></a>é¡¹ç›®é…ç½®(spring-boot:1.5.x)</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependecies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.1.1 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- prometheusç›¸å…³ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-spring-legacy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-registry-prometheus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Actuator (with security enabled) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependecies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="grafana"><a href="#grafana" class="headerlink" title="grafana"></a>grafana</h2><p><img src="../assets/grafana-01.png" alt=""></p>
<p><img src="../assets/grafana-02.png" alt=""></p>
<p><img src="../assets/grafana-03.png" alt=""></p>
<p>Dashboard for Spring Boot 1.x applications, using Micrometer and Prometheus.</p>
<h3 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h3><ul>
<li>Overall status</li>
<li>API stats</li>
<li>Tomcat</li>
<li>JVM</li>
</ul>
<h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p>Only one variable is declared in Grafana:<br>åœ¨è¯¥dashboardä¸­æœ‰ä¸€ä¸ªå˜é‡ <code>$job</code>, ç”¨æ¥æ ‡è¯†jobå, ç­‰åŒäº<code>prometheus</code>ä¸­çš„<code>job_name</code>,<br>ä¸è¿‡åœ¨ç›‘æ§<code>consul</code>çš„æœåŠ¡æ—¶, ç”¨æ¥æ ‡è¯†æœåŠ¡å, å³é¡¹ç›®é‡Œé…ç½®çš„ <code>spring.application.name</code></p>
<p>é…ç½®æ–¹å¼:</p>
<p>{dashboard} -&gt; settings -&gt; Variables</p>
<h2 id="promethues-é…ç½®"><a href="#promethues-é…ç½®" class="headerlink" title="promethues é…ç½®"></a>promethues é…ç½®</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘æ§consul</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># cousul_services</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'consul_services'</span></span><br><span class="line"><span class="attr">    consul_sd_configs:</span></span><br><span class="line"><span class="attr">      - server:</span> <span class="string">'$&#123;consul-server&#125;:8500'</span></span><br><span class="line"><span class="attr">        services:</span> <span class="string">['$&#123;server.name&#125;']</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># ä¿®æ”¹æŠ“å–route</span></span><br><span class="line"><span class="attr">    relabel_configs:</span></span><br><span class="line"><span class="attr">        - source_labels:</span> <span class="string">['__metrics_path__']</span></span><br><span class="line"><span class="attr">          regex:</span>         <span class="string">'/metrics'</span></span><br><span class="line"><span class="attr">          target_label:</span>  <span class="string">__metrics_path__</span></span><br><span class="line"><span class="attr">          replacement:</span>   <span class="string">'/prometheus'</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># é€šè¿‡consulç›‘æ§æ‰€æœ‰æœåŠ¡</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'consul_server'</span></span><br><span class="line"><span class="attr">    metrics_path:</span> <span class="string">'/prometheus'</span></span><br><span class="line"><span class="attr">    consul_sd_configs:</span></span><br><span class="line"><span class="attr">      - server:</span> <span class="string">'$&#123;consul-server&#125;:8500'</span></span><br><span class="line"><span class="attr">        services:</span> <span class="string">['$&#123;server.name&#125;']</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹æŠ“å–route</span></span><br><span class="line"><span class="attr">    relabel_configs:</span></span><br><span class="line"><span class="attr">        - source_labels:</span> <span class="string">['__meta_consul_service']</span></span><br><span class="line"><span class="attr">          regex:</span>         <span class="string">'(.*)'</span></span><br><span class="line"><span class="attr">          replacement:</span>   <span class="string">'$1'</span></span><br><span class="line"><span class="attr">          action:</span>        <span class="string">replace</span></span><br><span class="line"><span class="attr">          target_label:</span>  <span class="string">'job'</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç›‘æ§æ™®é€šspring-booté¡¹ç›®</span></span><br><span class="line">  <span class="comment"># for https</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">my-app-prod</span></span><br><span class="line"><span class="attr">    scheme:</span> <span class="string">https</span></span><br><span class="line"><span class="attr">    basic_auth:</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">your_actuator_user</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">your_actuator_password</span></span><br><span class="line"><span class="attr">    metrics_path:</span> <span class="string">/MyApp/actuator/prometheus</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">      - targets:</span></span><br><span class="line"><span class="bullet">          -</span> <span class="string">"your_hostname:your_port"</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># for http</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">my-app-prod</span></span><br><span class="line"><span class="attr">    scheme:</span> <span class="string">http</span></span><br><span class="line"><span class="attr">    metrics_path:</span> <span class="string">/MyApp/actuator/prometheus</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">      - targets:</span></span><br><span class="line"><span class="bullet">          -</span> <span class="string">"your_hostname:your_port"</span></span><br></pre></td></tr></table></figure>
<h2 id="æ•ˆæœé¢„è§ˆ"><a href="#æ•ˆæœé¢„è§ˆ" class="headerlink" title="æ•ˆæœé¢„è§ˆ"></a>æ•ˆæœé¢„è§ˆ</h2><p><img src="../assets/grafana-preview.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€spring-bootã€‘é…ç½®grafana/" data-id="cjs2ln90i000mi3uin6aaqieo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/spring-boot/">spring-boot</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€spring-cloudã€‘ribbonæ¢ç´¢" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€spring-cloudã€‘ribbonæ¢ç´¢/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€spring-cloudã€‘ribbonæ¢ç´¢/">
                ã€spring-cloudã€‘ribbonæ¢ç´¢
            </a>
            
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯è´Ÿè½½å‡è¡¡é‡è¯•</span><br><span class="line">spring.cloud.loadbalancer.retry.enabled: true</span><br><span class="line">ribbon:</span><br><span class="line">  # æœ€å¤šé‡è¯•å¤šå°‘å°æœåŠ¡</span><br><span class="line">  MaxAutoRetriesNextServer: 2</span><br><span class="line">  # æ¯å°æœåŠ¡å™¨æœ€å¤šé‡è¯•æ¬¡æ•°ï¼Œä½†æ˜¯é¦–æ¬¡è°ƒç”¨ä¸åŒ…æ‹¬åœ¨å†…</span><br><span class="line">  MaxAutoRetries: 1</span><br><span class="line">  # è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">  ConnectTimeout: 1000</span><br><span class="line">  # è¯»å–è¶…æ—¶æ—¶é—´</span><br><span class="line">  ReadTimeout: 3000</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé’ˆå¯¹æŸä¸ªæœåŠ¡åšè´Ÿè½½å‡è¡¡, å¯æŠŠ ribbon é…ç½®æ”¾åœ¨è¯¥æœåŠ¡èŠ‚ç‚¹ä¸‹, æ¯”å¦‚: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xxx-server:</span><br><span class="line">  ribbon:</span><br><span class="line">    # æœ€å¤šé‡è¯•å¤šå°‘å°æœåŠ¡</span><br><span class="line">    MaxAutoRetriesNextServer: 2</span><br><span class="line">    # æ¯å°æœåŠ¡å™¨æœ€å¤šé‡è¯•æ¬¡æ•°ï¼Œä½†æ˜¯é¦–æ¬¡è°ƒç”¨ä¸åŒ…æ‹¬åœ¨å†…</span><br><span class="line">    MaxAutoRetries: 1</span><br><span class="line">    # è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">    ConnectTimeout: 1000</span><br><span class="line">    # è¯»å–è¶…æ—¶æ—¶é—´</span><br><span class="line">    ReadTimeout: 3000</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä½¿ç”¨æ³¨è§£: @RibbonClients, @RibbonClient(name=â€xxx-serverâ€, configuration=XXXConfiguration.class)</p>
<h2 id="é…ç½®ç±»æºç è¿½æº¯"><a href="#é…ç½®ç±»æºç è¿½æº¯" class="headerlink" title="é…ç½®ç±»æºç è¿½æº¯"></a>é…ç½®ç±»æºç è¿½æº¯</h2><blockquote>
<p>é…ç½®ç›¸å…³ key<br>com.netflix.client.config.CommonClientConfigKey</p>
<p>ribbon ClientConfig æ„é€ å™¨<br>com.netflix.client.config.IClientConfig.Builder</p>
<p>é»˜è®¤å€¼(é™¤ connectTimeout, readTimeout å¤–, å…¶ä»–é…ç½®éƒ½ä½¿ç”¨è¯¥ç±»ä¸­çš„é»˜è®¤å€¼, å‰é¢ä¸¤ä¸ªå±æ€§åœ¨ RibbonClientConfiguration å·²ç»å£°æ˜)<br>com.netflix.client.config.DefaultClientConfigImpl</p>
</blockquote>
<blockquote>
<p>ğŸ’¡:bulb:<br>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªåœ°æ–¹<br>connectTimeout, readTimeout å¦‚æœæ²¡æœ‰æ˜¾å¼é…ç½®, é»˜è®¤å€¼ä¸º: 1000, 1000.</p>
<blockquote>
<p>org.springframework.cloud.netflix.ribbon.RibbonClientConfiguration#DEFAULT_CONNECT_TIMEOUT = 1000<br>org.springframework.cloud.netflix.ribbon.RibbonClientConfiguration#DEFAULT_READ_TIMEOUT = 1000<br>åˆå§‹åŒ– RibbonClientConfig çš„ä½ç½®åœ¨ org.springframework.cloud.netflix.ribbon.RibbonClientConfiguration#ribbonClientConfig.</p>
</blockquote>
<p>æœ‰é…ç½®çš„æ—¶å€™,è‡ªç„¶ä½¿ç”¨é…ç½®çš„value, DefaultClientConfigImplé‡Œçš„é»˜è®¤å€¼ç„¶è€Œå¹¶æ²¡æœ‰ç”¨åˆ°(ps: åº”è¯¥åœ¨å…¶ä»–åœ°æ–¹ç”¨åˆ°äº†: HttpClientRibbonConfiguration, OkHttpRibbonConfiguration)</p>
<p>è¿™å¤§æ¦‚å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æœåŠ¡(ç‰µæ¶‰åˆ°ä¸‰æ–¹è°ƒç”¨)ç»å¸¸å‡ºç°è¶…æ—¶çš„åŸå› </p>
</blockquote>
<h2 id="è´Ÿè½½å‡è¡¡è§„åˆ™"><a href="#è´Ÿè½½å‡è¡¡è§„åˆ™" class="headerlink" title="è´Ÿè½½å‡è¡¡è§„åˆ™"></a>è´Ÿè½½å‡è¡¡è§„åˆ™</h2><ul>
<li><strong>ClientConfigEnabledRoundRobinRule</strong> å†…åµŒäº†ä¸€ä¸ª <strong>RoundRobinRule</strong><ul>
<li><strong>BestAvailableRule</strong>         æœ€ä¼˜å¯ç”¨: è·å–å…¶ä¸­ActiveRequestsCountæœ€å°çš„æœåŠ¡</li>
<li><strong>PredicateBasedRule</strong>        åŸºäº Predicate çš„è§„åˆ™ <ul>
<li><strong>ZoneAvoidanceRule</strong>       åŒºåŸŸå»é™¤åˆ¤å®š: åˆ¤æ–­æŸä¸ªåŒºåŸŸçš„è¿è¡Œæ€§èƒ½æ˜¯å¦å¯ç”¨, æå‡ºä¸å¯ç”¨çš„åŒºåŸŸ(è¯¥åŒºåŸŸä¸‹çš„æ‰€æœ‰æœåŠ¡)</li>
<li><strong>AvailabilityFilterRule</strong>  å¯ç”¨æ€§åˆ¤å®š: è¿‡æ»¤æ‰è¿æ¥æ•°è¿‡å¤šçš„server</li>
</ul>
</li>
</ul>
</li>
<li><strong>RoundRobinRule</strong>              è½®è¯¢<ul>
<li><strong>WeightedResponseTimeRule</strong>  æ ¹æ®å“åº”æ—¶é—´åˆ†é…ä¸€ä¸ªweightï¼Œå“åº”æ—¶é—´è¶Šé•¿ï¼Œweightè¶Šå°ï¼Œè¢«é€‰ä¸­çš„å¯èƒ½æ€§è¶Šä½</li>
<li><strong>ResponseTimeWeightTimeRule</strong> (??? use WeightedResponseTimeRule instead)</li>
</ul>
</li>
<li><strong>RandomRule</strong> éšæœº</li>
<li><strong>RetryRule</strong>  é‡è¯•è§„åˆ™, å¤±è´¥ä¹‹åä¼šåœ¨æŒ‡å®šæ—¶é—´å†…ä»¥subRuleç»§ç»­è·å–æœåŠ¡, é»˜è®¤subRule=RoundRobinRule</li>
</ul>
<p>è§„åˆ™é…ç½®æ–¹å¼(ä»¥ RetryRule ä¸ºä¾‹):</p>
<ul>
<li>propertiesæ–¹å¼</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ribbon:</span><br><span class="line">  NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RetryRule</span><br></pre></td></tr></table></figure>
<ul>
<li>java config</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">IRule rule() &#123;</span><br><span class="line">    RetryRule retryRule = new RetryRule();</span><br><span class="line">    retryRule.setMaxRetryMillis(1000);</span><br><span class="line">    retryRule.setRule(subRule());</span><br><span class="line">    return retryRule;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">IRule subRule() &#123;</span><br><span class="line">    return new RoundRobinRule();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤è§„åˆ™: com.netflix.loadbalancer.AvailabilityFilteringRule</p>
<h2 id="ä¾èµ–è¯´æ˜"><a href="#ä¾èµ–è¯´æ˜" class="headerlink" title="ä¾èµ–è¯´æ˜"></a>ä¾èµ–è¯´æ˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;Edgware.SR3&lt;/version&gt;</span><br><span class="line">          &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">          &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><ul>
<li><a href="https://github.com/Netflix/ribbon/wiki/Getting-Started" target="_blank" rel="noopener">https://github.com/Netflix/ribbon/wiki/Getting-Started</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€spring-cloudã€‘ribbonæ¢ç´¢/" data-id="cjs2ln90j000oi3uixgvm1dxb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/spring-cloud/">spring-cloud</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€spring-cloudã€‘spring-cloud-config" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€spring-cloudã€‘spring-cloud-config/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€spring-cloudã€‘spring-cloud-config/">
                ã€spring-cloudã€‘spring-cloud-config
            </a>
            
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="server"><a href="#server" class="headerlink" title="server"></a>server</h2><ul>
<li><p>ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ymlé…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      server:</span></span><br><span class="line"><span class="attr">        git:</span></span><br><span class="line">          <span class="comment"># é…ç½®çš„gitè·¯å¾„</span></span><br><span class="line"><span class="attr">          uri:</span> <span class="attr">http://xxx/oasis-ct/oasis-ct-config.git</span></span><br><span class="line">          <span class="comment"># æŸ¥æ‰¾è·¯å¾„</span></span><br><span class="line">          <span class="comment"># é»˜è®¤æŸ¥æ‰¾æ ¹ç›®å½•, è€Œä¸”åªæŸ¥æ‰¾ä¸€çº§ç›®å½•</span></span><br><span class="line"><span class="attr">          search-paths:</span> <span class="string">repo</span></span><br><span class="line"><span class="attr">      profile:</span> <span class="string">$&#123;spring.profiles&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>å¦‚æœæƒ³æŠŠé…ç½®ä¸­å¿ƒä»¥æœåŠ¡çš„å½¢å¼é…ç½®åˆ°consulä¸­, å¯ä»¥æŒ‰ç…§æœåŠ¡æ³¨å†Œçš„å½¢å¼è¿›è¡Œé…ç½®</p>
</blockquote>
<h2 id="client"><a href="#client" class="headerlink" title="client"></a>client</h2><ul>
<li><p>ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ymlé…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="comment"># é…ç½®ä¸­å¿ƒ</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line">      <span class="comment"># 1. ç›´æ¥è®¿é—®æ–¹å¼</span></span><br><span class="line"><span class="attr">      uri:</span> <span class="string">`&#123;config-server&#125;`</span></span><br><span class="line">      <span class="comment"># 2. æœåŠ¡æ³¨å†Œåˆ°consul, éœ€è¦æŒ‰ä¸‹é¢çš„æ–¹å¼é…ç½®      </span></span><br><span class="line"><span class="comment">#      discovery:</span></span><br><span class="line"><span class="comment">#        enabled: truegetDeliveryInfo</span></span><br><span class="line"><span class="comment">#        service-id: oasis-ct-config</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># ç”±äºå’±ä»¬çš„é¡¹ç›®åæ¯”è¾ƒé•¿, è¿™é‡Œå¯ä»¥é‡å‘½å, </span></span><br><span class="line">      <span class="comment"># åŒæ—¶configæœåŠ¡é‡Œçš„é…ç½®æ–‡ä»¶çš„æ–‡ä»¶åå‘½åæ–¹å¼: medicine-&#123;profile&#125;.yml</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">medicine</span></span><br><span class="line"><span class="attr">      profile:</span> <span class="string">$&#123;spring.profiles&#125;</span></span><br><span class="line"><span class="attr">      fail-fast:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€spring-cloudã€‘spring-cloud-config/" data-id="cjs2ln90j000qi3ui11gtrdlf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/spring-cloud/">spring-cloud</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€bootstrapã€‘file-input" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€bootstrapã€‘file-input/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€bootstrapã€‘file-input/">
                ã€bootstrapã€‘file-input
            </a>
            
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>æš‚æ—¶ä¸é€‚ç”¨è¯¥æ–¹å¼ä¸Šä¼ æ–‡ä»¶</p>
</blockquote>
<h1 id="æ–‡ä»¶ä¸Šä¼ æ’ä»¶"><a href="#æ–‡ä»¶ä¸Šä¼ æ’ä»¶" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ’ä»¶"></a>æ–‡ä»¶ä¸Šä¼ æ’ä»¶</h1><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="http://plugins.krajee.com/file-input" target="_blank" rel="noopener">fileinput</a></p>
<h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><ul>
<li><p>å¼•å…¥css</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"&lt;c:url value="</span>/<span class="attr">assets</span>/<span class="attr">bower_components</span>/<span class="attr">bootstrap-fileinput</span>/<span class="attr">css</span>/<span class="attr">fileinput.min.css</span>"/&gt;</span>"/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¼•å…¥js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;&lt;c:url value=&quot;/assets/bower_components/bootstrap-fileinput/js/fileinput.min.js&quot;/&gt;&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;&lt;c:url value=&quot;/assets/bower_components/bootstrap-fileinput/js/locales/zh.js&quot;/&gt;&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;&lt;c:url value=&quot;/assets/bower_components/bootstrap-fileinput/js/plugins/piexif.min.js&quot;/&gt;&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è¯¥æ’ä»¶éœ€è¦</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"f1"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">class</span>=<span class="string">"file"</span> <span class="attr">data-show-preview</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$scope.initFileinput(<span class="string">"#f1"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$scope.initFileinput = <span class="function"><span class="keyword">function</span> (<span class="params">fileinputId</span>) </span>&#123;</span><br><span class="line">    $(fileinputId).fileinput(&#123;</span><br><span class="line">        <span class="string">"uploadUrl"</span>: <span class="string">"/fileUpload/upload"</span>,</span><br><span class="line">        <span class="string">"maxFileSize"</span>: <span class="number">20480</span>,</span><br><span class="line">        <span class="string">"msgSizeTooLarge"</span>: <span class="string">"æ–‡ä»¶(&#123;name&#125; - &#123;size&#125; KB) è¶…è¿‡æœ€å¤§é™åˆ¶ &#123;maxSize&#125; KB. è¯·é‡æ–°ä¸Šä¼ !"</span></span><br><span class="line">    &#125;);</span><br><span class="line">    $(fileinputId).on(<span class="string">'fileuploaded'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event, data, previewId, index</span>) </span>&#123;</span><br><span class="line">        $scope.taskRequest.fileName = data.response.fileName;</span><br><span class="line">        $scope.taskRequest.fileUrl = data.response.path;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€bootstrapã€‘file-input/" data-id="cjs2ln8zy0001i3uifjdkjm6m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/bootstrap/">bootstrap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/fileinput/">fileinput</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€spring-cloudã€‘æœåŠ¡è°ƒç”¨è¿½è¸ª" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€spring-cloudã€‘æœåŠ¡è°ƒç”¨è¿½è¸ª/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€spring-cloudã€‘æœåŠ¡è°ƒç”¨è¿½è¸ª/">
                ã€spring-cloudã€‘æœåŠ¡è°ƒç”¨è¿½è¸ª
            </a>
            
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>æœåŠ¡ç›‘æ§â€”â€”æœåŠ¡è°ƒç”¨é“¾è¿½è¸ªï¼Œå¸®åŠ©è¿½è¸ªæ¯ä¸ªè¯·æ±‚çš„è°ƒç”¨è¿‡ç¨‹åŠæ¯ä¸ªè¿‡ç¨‹çš„ç½‘ç»œå»¶è¿Ÿã€ä¸šåŠ¡è€—æ—¶ç­‰æŒ‡æ ‡</p>
<p>æœåŠ¡è°ƒç”¨è¿½è¸ªä¸»è¦æ˜¯æ ¹æ® traceId, spanId, parentSpanId åœ¨ä¸ªæœåŠ¡æ—¥å¿—ä¸Šè¿›è¡Œæ ‡è®°, ä¸€ä¸ªtraceIdæ ‡è®°ä¸€ä¸ªè¯·æ±‚, spanIdæ ‡è®°é“¾è·¯, parentSpanIdä¸ºä¸Šä¸€æ¡é“¾è·¯çš„spanId, ç”±traceIdæŠŠæ‰€æœ‰çš„spanIdä¸²è”èµ·æ¥, åœ¨ç¬¬ä¸€æ¡é“¾è·¯ä¸Š traceId = spanId = parentSpanId.</p>
<h2 id="é…ç½®æ­¥éª¤"><a href="#é…ç½®æ­¥éª¤" class="headerlink" title="é…ç½®æ­¥éª¤"></a>é…ç½®æ­¥éª¤</h2><h3 id="é…ç½®-ELK-ï¼ˆä¾¿äºæŸ¥è¯¢æ•´ä¸ªè¯·æ±‚çš„å¤„ç†æ—¥å¿—ï¼‰"><a href="#é…ç½®-ELK-ï¼ˆä¾¿äºæŸ¥è¯¢æ•´ä¸ªè¯·æ±‚çš„å¤„ç†æ—¥å¿—ï¼‰" class="headerlink" title="é…ç½® ELK ï¼ˆä¾¿äºæŸ¥è¯¢æ•´ä¸ªè¯·æ±‚çš„å¤„ç†æ—¥å¿—ï¼‰"></a>é…ç½® ELK ï¼ˆä¾¿äºæŸ¥è¯¢æ•´ä¸ªè¯·æ±‚çš„å¤„ç†æ—¥å¿—ï¼‰</h3><ul>
<li><p>æ·»åŠ ä¾èµ–</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ <code>logback-spring.xml</code> çš„ <code>LOGSTASH</code> èŠ‚ç‚¹ä¸‹æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;additionalField&gt;</span><br><span class="line">    &lt;key&gt;X-B3-ParentSpanId&lt;/key&gt;</span><br><span class="line">    &lt;value&gt;@&#123;X-B3-ParentSpanId&#125;&lt;/value&gt;</span><br><span class="line">&lt;/additionalField&gt;</span><br><span class="line">&lt;additionalField&gt;</span><br><span class="line">    &lt;key&gt;X-B3-SpanId&lt;/key&gt;</span><br><span class="line">    &lt;value&gt;@&#123;X-B3-SpanId&#125;&lt;/value&gt;</span><br><span class="line">&lt;/additionalField&gt;</span><br><span class="line">&lt;additionalField&gt;</span><br><span class="line">    &lt;key&gt;X-B3-TraceId&lt;/key&gt;</span><br><span class="line">    &lt;value&gt;@&#123;X-B3-TraceId&#125;&lt;/value&gt;</span><br><span class="line">&lt;/additionalField&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>å‚è€ƒï¼š[oasis-ct-product-server](/oasis-ct/oasis-ct-product/src/master/oasis-ct-product-server/src/main/resources/logback-spring.xml)
</code></pre><h3 id="é…ç½®-zipkin"><a href="#é…ç½®-zipkin" class="headerlink" title="é…ç½® zipkin"></a>é…ç½® zipkin</h3><ul>
<li><p>æ·»åŠ ä¾èµ–</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-sleuth-zipkin&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ <code>application-dev.yml</code> / <code>application-test.yml</code> ä¸­é…ç½®ï¼š</p>
  <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  zipkin:</span></span><br><span class="line"><span class="attr">    enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># zipkin éƒ¨ç½²åœ¨ op æœåŠ¡å™¨</span></span><br><span class="line"><span class="attr">    base-url:</span> <span class="attr">http://10.163.149.166:11001</span></span><br><span class="line"><span class="attr">  sleuth:</span></span><br><span class="line"><span class="attr">    enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    sampler:</span></span><br><span class="line">      <span class="comment"># é‡‡æ ·çš„æ¯”ä¾‹</span></span><br><span class="line"><span class="attr">      percentage:</span> <span class="number">1.0</span></span><br><span class="line"><span class="attr">    scheduled:</span></span><br><span class="line">      <span class="comment"># å…³é—­ scheduled æ–¹æ³•çš„é‡‡æ ·ï¼Œå¦åˆ™ zipkin ä¸Šä¸€å †å¼‚æ­¥ä»»åŠ¡çš„ traceï¼Œå°¤å…¶æ˜¯ consul watch task</span></span><br><span class="line">      <span class="comment"># Refer: [scheduled_annotated_methods]</span></span><br><span class="line"><span class="attr">      enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>å¦‚æœæŸä¸ªç¯å¢ƒæ²¡æœ‰é… zipkin, ä¼šæŒ‰ç…§é»˜è®¤å€¼è¿›è¡Œè¯·æ±‚zipkin, æ‰€ä»¥æœ€å¥½é…ç½®enabled=false, ç¦ç”¨zipkin:

`spring.zipkin.enabled: false`
</code></pre><ul>
<li><p>æ£€æŸ¥é…ç½®æ˜¯å¦æˆåŠŸ</p>
<p>  è®¿é—®ä»»æ„ä¸€ä¸ªæ¥å£ï¼Œåœ¨ [zipkin] ä¸­æŸ¥çœ‹æ˜¯å¦æœ‰è¯¥è¯·æ±‚çš„è®°å½•</p>
<p>  æŸ¥ä¸åˆ°çš„åŸå› ï¼š</p>
<pre><code>- é…ç½®æ²¡æœ‰æˆåŠŸ
- ç”±äºé‡‡æ ·é…ç½®ä¸æ˜¯ 1.0ï¼Œå¯¼è‡´æ²¡æœ‰é‡‡æ ·(æ‰€è°“é‡‡æ ·, å°±æ˜¯å½“å‰æ—¥å¿—ä¼šä¸ä¼šæ‰“åˆ° zipkin ä¸Š)
</code></pre></li>
<li><p>å‚è€ƒ</p>
<p>  <a href="/oasis-ct/oasis-ct-product/src/master/oasis-ct-product-server/src/main/resources/config/application-dev.yml">oasis-ct-product-server</a></p>
</li>
</ul>
<h2 id="éšæœºé‡‡æ ·åŸç†"><a href="#éšæœºé‡‡æ ·åŸç†" class="headerlink" title="éšæœºé‡‡æ ·åŸç†"></a>éšæœºé‡‡æ ·åŸç†</h2><p>å‚è€ƒ: <code>org.springframework.cloud.sleuth.sampler.PercentageBasedSampler#isSampled</code></p>
<ul>
<li><a href="http://stackoverflow.com/questions/12817946/generate-a-random-bitset-with-n-1s" target="_blank" rel="noopener">generate-a-random-bitset-with-n-1s</a></li>
</ul>
<h2 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h2><ul>
<li><p>å¯ä»¥å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—å¸®åŠ©è§£è€¦åŠæå‡æ•ˆç‡</p>
</li>
<li><p>é›†æˆ ELK ä¹‹åï¼Œåœ¨æ‰“å°éè¯·æ±‚çš„æ—¥å¿—é‡Œï¼Œ<code>X-B3-*</code> ç›¸å…³çš„å­—æ®µæ˜¾ç¤ºçš„æ˜¯ <code>X-B3-*_NOT_FOUND</code></p>
<p>ç†è®ºä¸Šåº”è¯¥æ˜¯ <code>-</code> æˆ– <code></code>ï¼ˆç©ºï¼‰ï¼Œçœ‹æºç  <code>com.cwbase.logback.JSONEventLayout#mdcSubst</code> ï¼Œæ˜¯æ¡†æ¶è‡ªå·±æ²¡æœ‰è®¾ç½®é»˜è®¤å€¼çš„æ–¹æ³•</p>
<p>æ‰€ä»¥æš‚æ—¶å…ˆä¸å¤„ç†ï¼Œæˆ–ä»¥åæ”¹ç”¨ <code>FileAppender</code> + <code>logstash</code> çš„æ–¹å¼æ”¶é›†æ—¥å¿—</p>
</li>
</ul>
<h2 id="ç›¸å…³æ–‡æ¡£"><a href="#ç›¸å…³æ–‡æ¡£" class="headerlink" title="ç›¸å…³æ–‡æ¡£"></a>ç›¸å…³æ–‡æ¡£</h2><ul>
<li><p><a href="https://cloud.spring.io/spring-cloud-sleuth/1.3.x/single/spring-cloud-sleuth.html" target="_blank" rel="noopener">spring-cloud-sleuth Reference</a></p>
</li>
<li><p>spring-cloud-sleuth: <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-sleuth/1.3.4.RELEASE/single/spring-cloud-sleuth.html#__scheduled_annotated_methods" target="_blank" rel="noopener">scheduled_annotated_methods</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/6d6b52c7624f" target="_blank" rel="noopener">Spring Cloud Sleuthä½¿ç”¨ç®€ä»‹</a></p>
</li>
<li><p>Spring Cloud Sleuth does not add trace/span related headers to the Http Response for security reasons. If you need the headers, see: <a href="https://cloud.spring.io/spring-cloud-sleuth/1.3.x/single/spring-cloud-sleuth.html#_example" target="_blank" rel="noopener">åœ¨http response ä¸­æ·»åŠ  trace header</a></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€spring-cloudã€‘æœåŠ¡è°ƒç”¨è¿½è¸ª/" data-id="cjs2ln90m000ti3ui0hfckljm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/spring-cloud/">spring-cloud</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€spring-cloudã€‘éƒ¨ç½²" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€spring-cloudã€‘éƒ¨ç½²/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€spring-cloudã€‘éƒ¨ç½²/">
                ã€spring-cloudã€‘éƒ¨ç½²
            </a>
            
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="æ„å»ºdockerå®¹å™¨"><a href="#æ„å»ºdockerå®¹å™¨" class="headerlink" title="æ„å»ºdockerå®¹å™¨"></a>æ„å»ºdockerå®¹å™¨</h2><p><a href="../docker/how-to-build-container.md">å¦‚ä½•æ„å»ºå®¹å™¨</a></p>
<h2 id="ä¼˜é›…å…³é—­æœåŠ¡"><a href="#ä¼˜é›…å…³é—­æœåŠ¡" class="headerlink" title="ä¼˜é›…å…³é—­æœåŠ¡"></a>ä¼˜é›…å…³é—­æœåŠ¡</h2><p><a href="/spring-boot/ä¼˜é›…å…³é—­æœåŠ¡.md">ä¼˜é›…å…³é—­æœåŠ¡</a></p>
<h2 id="è¿œç¨‹è°ƒè¯•"><a href="#è¿œç¨‹è°ƒè¯•" class="headerlink" title="è¿œç¨‹è°ƒè¯•"></a>è¿œç¨‹è°ƒè¯•</h2><p>ä¿®æ”¹å®Œæˆåï¼Œè¯·ä¿®æ”¹æ–‡æ¡£ï¼š<a href="../oasis-ct/åŸºç¡€æœåŠ¡åˆ—è¡¨.md">åŸºç¡€æœåŠ¡åˆ—è¡¨</a></p>
<p>å¯åŠ¨æ—¶ï¼ŒåŠ ä¸Š <code>-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=[debug port]</code></p>
<p>æ³¨æ„åŠ ä¸Šè¿œç¨‹è°ƒè¯•å‰ï¼Œä¹Ÿè¦åœ¨dockerä¸­é…ç½®è°ƒè¯•ç«¯å£çš„<strong>æ˜ å°„</strong></p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„é…ç½®:</p>
<blockquote>
<p>java<br>-Dfile.encoding=UTF-8<br>-Duser.timezone=GMT+08<br>-Dspring.profiles.active=[profile]<br>-Xdebug<br>-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=[debug port]<br>-jar [jar]</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€spring-cloudã€‘éƒ¨ç½²/" data-id="cjs2ln90n000ui3uia7duaa8q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/spring-cloud/">spring-cloud</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€spring-cloudã€‘é—®é¢˜è®°å½•" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€spring-cloudã€‘é—®é¢˜è®°å½•/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€spring-cloudã€‘é—®é¢˜è®°å½•/">
                ã€spring-cloudã€‘é—®é¢˜è®°å½•
            </a>
            
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p>feign è¯·æ±‚ get åè¿”å› post 404 error</p>
<ul>
<li>æ£€æŸ¥è¯·æ±‚è·¯å¾„æ˜¯å¦æ­£ç¡®</li>
<li>æ£€æŸ¥æ˜¯å¦Getè¯·æ±‚å‚æ•°ä¸ºå¯¹è±¡ï¼Œ@see <a href="feign%20not%20support%20object%20param%20by%20GET.md">feign not support object param by GET</a></li>
</ul>
</li>
<li><p>feign å‚æ•°ä¸­æœ‰ Date å‚æ•°æ—¶ï¼Œä¿è¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ ¼å¼ä¸€æ ·</p>
<p>spring boot ä¸‹é…ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  jackson:</span><br><span class="line">    date-format: yyyy-MM-dd HH:mm:ss</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>@FeignClient è¢«æ³¨å†Œä¸º RequestHandlerï¼Œå¯¼è‡´ä¸æœåŠ¡æ¥å£ duplicate</li>
</ul>
<blockquote>
<p>@FeignClient with top level @RequestMapping annotation is also registered as Spring MVC handler</p>
</blockquote>
<p>see: <a href="https://github.com/spring-cloud/spring-cloud-netflix/issues/466" target="_blank" rel="noopener">https://github.com/spring-cloud/spring-cloud-netflix/issues/466</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€spring-cloudã€‘é—®é¢˜è®°å½•/" data-id="cjs2ln90o000xi3ui3neujkfc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/spring-cloud/">spring-cloud</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/wiki/">&laquo; Prev</a><a class="page-number" href="/wiki/">1</a><span class="page-number current">2</span><a class="page-number" href="/wiki/page/3/">3</a><a class="page-number" href="/wiki/page/4/">4</a><a class="extend next" rel="next" href="/wiki/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/beego/">beego</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/bootstrap/">bootstrap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/consul/">consul</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/elastic-job/">elastic-job</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/eventbus/">eventbus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/feign/">feign</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/fileinput/">fileinput</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/golang/">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/guava/">guava</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/hikari/">hikari</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/mgo/">mgo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/mybatis/">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/spring/">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/spring-boot/">spring-boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/spring-cloud/">spring-cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/spring-data/">spring-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/æœåŠ¡æ¶æ„/">æœåŠ¡æ¶æ„</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/é¡¹ç›®ç®¡ç†/">é¡¹ç›®ç®¡ç†</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/wiki/tags/beego/" style="font-size: 10px;">beego</a> <a href="/wiki/tags/bootstrap/" style="font-size: 10px;">bootstrap</a> <a href="/wiki/tags/consul/" style="font-size: 10px;">consul</a> <a href="/wiki/tags/docker/" style="font-size: 12.5px;">docker</a> <a href="/wiki/tags/elastic-job/" style="font-size: 10px;">elastic-job</a> <a href="/wiki/tags/eventbus/" style="font-size: 10px;">eventbus</a> <a href="/wiki/tags/feign/" style="font-size: 10px;">feign</a> <a href="/wiki/tags/fileinput/" style="font-size: 10px;">fileinput</a> <a href="/wiki/tags/git/" style="font-size: 10px;">git</a> <a href="/wiki/tags/golang/" style="font-size: 12.5px;">golang</a> <a href="/wiki/tags/guava/" style="font-size: 10px;">guava</a> <a href="/wiki/tags/hikari/" style="font-size: 10px;">hikari</a> <a href="/wiki/tags/mgo/" style="font-size: 10px;">mgo</a> <a href="/wiki/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/wiki/tags/php/" style="font-size: 10px;">php</a> <a href="/wiki/tags/redis/" style="font-size: 10px;">redis</a> <a href="/wiki/tags/spring/" style="font-size: 10px;">spring</a> <a href="/wiki/tags/spring-boot/" style="font-size: 15px;">spring-boot</a> <a href="/wiki/tags/spring-cloud/" style="font-size: 20px;">spring-cloud</a> <a href="/wiki/tags/spring-data/" style="font-size: 10px;">spring-data</a> <a href="/wiki/tags/æœåŠ¡æ¶æ„/" style="font-size: 10px;">æœåŠ¡æ¶æ„</a> <a href="/wiki/tags/é¡¹ç›®ç®¡ç†/" style="font-size: 17.5px;">é¡¹ç›®ç®¡ç†</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/wiki/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/wiki/archives/2018/11/">November 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/wiki/2019/02/12/todolist/">todolist</a>
          </li>
        
          <li>
            <a href="/wiki/2018/11/05/ã€spring-cloudã€‘åœ¨ç½‘å…³ä¸­é…ç½®swagger/">ã€spring-cloudã€‘åœ¨ç½‘å…³ä¸­é…ç½®swagger</a>
          </li>
        
          <li>
            <a href="/wiki/2018/11/05/ã€consulã€‘dockeré…ç½®/">ã€consulã€‘dockeré…ç½®</a>
          </li>
        
          <li>
            <a href="/wiki/2018/11/05/ã€dockerã€‘åˆ›å»ºjavaå®¹å™¨/">ã€dockerã€‘åˆ›å»ºjavaå®¹å™¨</a>
          </li>
        
          <li>
            <a href="/wiki/2018/11/05/ã€dockerã€‘æ€ä¸æ­»çš„docker/">ã€dockerã€‘æ€ä¸æ­»çš„docker</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Sucre Cui<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/wiki/" class="mobile-nav-link">Home</a>
  
    <a href="/wiki/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/wiki/fancybox/jquery.fancybox.css">
  <script src="/wiki/fancybox/jquery.fancybox.pack.js"></script>


<script src="/wiki/js/script.js"></script>



  </div>
</body>
</html>