<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>wiki</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="just like a wiki">
<meta name="keywords" content="wiki">
<meta property="og:type" content="website">
<meta property="og:title" content="wiki">
<meta property="og:url" content="https://jpcui.github.io/wiki/index.html">
<meta property="og:site_name" content="wiki">
<meta property="og:description" content="just like a wiki">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="wiki">
<meta name="twitter:description" content="just like a wiki">
  
    <link rel="alternate" href="/wiki/atom.xml" title="wiki" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/wiki/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/wiki/" id="logo">wiki</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/wiki/" id="subtitle">just like a wiki</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/wiki/">Home</a>
        
          <a class="main-nav-link" href="/wiki/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/wiki/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://jpcui.github.io/wiki"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-todolist" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2019/02/12/todolist/" class="article-date">
  <time datetime="2019-02-12T12:29:57.954Z" itemprop="datePublished">2019-02-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2019/02/12/todolist/">
                
                    ğŸ”
                
                todolist
            </a>
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p>BASEç†è®ºï¼ŒCAPï¼ŒAICD</p>
<p><a href="https://www.baidu.com/s?ie=UTF-8&amp;wd=BASE%E6%A8%A1%E5%9E%8B" target="_blank" rel="noopener">https://www.baidu.com/s?ie=UTF-8&amp;wd=BASE%E6%A8%A1%E5%9E%8B</a></p>
</li>
<li><p>ç½‘å…³</p>
</li>
<li><p>æ³¨å†Œä¸­å¿ƒ</p>
</li>
<li><p>æœåŠ¡å‘ç°ç»„ä»¶</p>
</li>
<li><p>æœåŠ¡è°ƒç”¨</p>
<ul>
<li><p>è´Ÿè´£æœåŠ¡é—´è°ƒç”¨</p>
</li>
<li><p>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</p>
</li>
</ul>
</li>
<li><p>æœåŠ¡å®¹é”™</p>
<ul>
<li><p>å®¢æˆ·ç«¯å®¹é”™</p>
</li>
<li><p>æœåŠ¡ç«¯å®¹é”™</p>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2019/02/12/todolist/" data-id="cjs2lihzn0003axuip9y20f5t" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ã€spring-cloudã€‘æœåŠ¡è°ƒç”¨è¿½è¸ª" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€spring-cloudã€‘æœåŠ¡è°ƒç”¨è¿½è¸ª/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€spring-cloudã€‘æœåŠ¡è°ƒç”¨è¿½è¸ª/">
                
                ã€spring-cloudã€‘æœåŠ¡è°ƒç”¨è¿½è¸ª
            </a>
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>æœåŠ¡ç›‘æ§â€”â€”æœåŠ¡è°ƒç”¨é“¾è¿½è¸ªï¼Œå¸®åŠ©è¿½è¸ªæ¯ä¸ªè¯·æ±‚çš„è°ƒç”¨è¿‡ç¨‹åŠæ¯ä¸ªè¿‡ç¨‹çš„ç½‘ç»œå»¶è¿Ÿã€ä¸šåŠ¡è€—æ—¶ç­‰æŒ‡æ ‡</p>
<p>æœåŠ¡è°ƒç”¨è¿½è¸ªä¸»è¦æ˜¯æ ¹æ® traceId, spanId, parentSpanId åœ¨ä¸ªæœåŠ¡æ—¥å¿—ä¸Šè¿›è¡Œæ ‡è®°, ä¸€ä¸ªtraceIdæ ‡è®°ä¸€ä¸ªè¯·æ±‚, spanIdæ ‡è®°é“¾è·¯, parentSpanIdä¸ºä¸Šä¸€æ¡é“¾è·¯çš„spanId, ç”±traceIdæŠŠæ‰€æœ‰çš„spanIdä¸²è”èµ·æ¥, åœ¨ç¬¬ä¸€æ¡é“¾è·¯ä¸Š traceId = spanId = parentSpanId.</p>
<h2 id="é…ç½®æ­¥éª¤"><a href="#é…ç½®æ­¥éª¤" class="headerlink" title="é…ç½®æ­¥éª¤"></a>é…ç½®æ­¥éª¤</h2><h3 id="é…ç½®-ELK-ï¼ˆä¾¿äºæŸ¥è¯¢æ•´ä¸ªè¯·æ±‚çš„å¤„ç†æ—¥å¿—ï¼‰"><a href="#é…ç½®-ELK-ï¼ˆä¾¿äºæŸ¥è¯¢æ•´ä¸ªè¯·æ±‚çš„å¤„ç†æ—¥å¿—ï¼‰" class="headerlink" title="é…ç½® ELK ï¼ˆä¾¿äºæŸ¥è¯¢æ•´ä¸ªè¯·æ±‚çš„å¤„ç†æ—¥å¿—ï¼‰"></a>é…ç½® ELK ï¼ˆä¾¿äºæŸ¥è¯¢æ•´ä¸ªè¯·æ±‚çš„å¤„ç†æ—¥å¿—ï¼‰</h3><ul>
<li><p>æ·»åŠ ä¾èµ–</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ <code>logback-spring.xml</code> çš„ <code>LOGSTASH</code> èŠ‚ç‚¹ä¸‹æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;additionalField&gt;</span><br><span class="line">    &lt;key&gt;X-B3-ParentSpanId&lt;/key&gt;</span><br><span class="line">    &lt;value&gt;@&#123;X-B3-ParentSpanId&#125;&lt;/value&gt;</span><br><span class="line">&lt;/additionalField&gt;</span><br><span class="line">&lt;additionalField&gt;</span><br><span class="line">    &lt;key&gt;X-B3-SpanId&lt;/key&gt;</span><br><span class="line">    &lt;value&gt;@&#123;X-B3-SpanId&#125;&lt;/value&gt;</span><br><span class="line">&lt;/additionalField&gt;</span><br><span class="line">&lt;additionalField&gt;</span><br><span class="line">    &lt;key&gt;X-B3-TraceId&lt;/key&gt;</span><br><span class="line">    &lt;value&gt;@&#123;X-B3-TraceId&#125;&lt;/value&gt;</span><br><span class="line">&lt;/additionalField&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>å‚è€ƒï¼š[oasis-ct-product-server](/oasis-ct/oasis-ct-product/src/master/oasis-ct-product-server/src/main/resources/logback-spring.xml)
</code></pre><h3 id="é…ç½®-zipkin"><a href="#é…ç½®-zipkin" class="headerlink" title="é…ç½® zipkin"></a>é…ç½® zipkin</h3><ul>
<li><p>æ·»åŠ ä¾èµ–</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-sleuth-zipkin&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ <code>application-dev.yml</code> / <code>application-test.yml</code> ä¸­é…ç½®ï¼š</p>
  <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  zipkin:</span></span><br><span class="line"><span class="attr">    enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># zipkin éƒ¨ç½²åœ¨ op æœåŠ¡å™¨</span></span><br><span class="line"><span class="attr">    base-url:</span> <span class="attr">http://10.163.149.166:11001</span></span><br><span class="line"><span class="attr">  sleuth:</span></span><br><span class="line"><span class="attr">    enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    sampler:</span></span><br><span class="line">      <span class="comment"># é‡‡æ ·çš„æ¯”ä¾‹</span></span><br><span class="line"><span class="attr">      percentage:</span> <span class="number">1.0</span></span><br><span class="line"><span class="attr">    scheduled:</span></span><br><span class="line">      <span class="comment"># å…³é—­ scheduled æ–¹æ³•çš„é‡‡æ ·ï¼Œå¦åˆ™ zipkin ä¸Šä¸€å †å¼‚æ­¥ä»»åŠ¡çš„ traceï¼Œå°¤å…¶æ˜¯ consul watch task</span></span><br><span class="line">      <span class="comment"># Refer: [scheduled_annotated_methods]</span></span><br><span class="line"><span class="attr">      enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>å¦‚æœæŸä¸ªç¯å¢ƒæ²¡æœ‰é… zipkin, ä¼šæŒ‰ç…§é»˜è®¤å€¼è¿›è¡Œè¯·æ±‚zipkin, æ‰€ä»¥æœ€å¥½é…ç½®enabled=false, ç¦ç”¨zipkin:

`spring.zipkin.enabled: false`
</code></pre><ul>
<li><p>æ£€æŸ¥é…ç½®æ˜¯å¦æˆåŠŸ</p>
<p>  è®¿é—®ä»»æ„ä¸€ä¸ªæ¥å£ï¼Œåœ¨ [zipkin] ä¸­æŸ¥çœ‹æ˜¯å¦æœ‰è¯¥è¯·æ±‚çš„è®°å½•</p>
<p>  æŸ¥ä¸åˆ°çš„åŸå› ï¼š</p>
<pre><code>- é…ç½®æ²¡æœ‰æˆåŠŸ
- ç”±äºé‡‡æ ·é…ç½®ä¸æ˜¯ 1.0ï¼Œå¯¼è‡´æ²¡æœ‰é‡‡æ ·(æ‰€è°“é‡‡æ ·, å°±æ˜¯å½“å‰æ—¥å¿—ä¼šä¸ä¼šæ‰“åˆ° zipkin ä¸Š)
</code></pre></li>
<li><p>å‚è€ƒ</p>
<p>  <a href="/oasis-ct/oasis-ct-product/src/master/oasis-ct-product-server/src/main/resources/config/application-dev.yml">oasis-ct-product-server</a></p>
</li>
</ul>
<h2 id="éšæœºé‡‡æ ·åŸç†"><a href="#éšæœºé‡‡æ ·åŸç†" class="headerlink" title="éšæœºé‡‡æ ·åŸç†"></a>éšæœºé‡‡æ ·åŸç†</h2><p>å‚è€ƒ: <code>org.springframework.cloud.sleuth.sampler.PercentageBasedSampler#isSampled</code></p>
<ul>
<li><a href="http://stackoverflow.com/questions/12817946/generate-a-random-bitset-with-n-1s" target="_blank" rel="noopener">generate-a-random-bitset-with-n-1s</a></li>
</ul>
<h2 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h2><ul>
<li><p>å¯ä»¥å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—å¸®åŠ©è§£è€¦åŠæå‡æ•ˆç‡</p>
</li>
<li><p>é›†æˆ ELK ä¹‹åï¼Œåœ¨æ‰“å°éè¯·æ±‚çš„æ—¥å¿—é‡Œï¼Œ<code>X-B3-*</code> ç›¸å…³çš„å­—æ®µæ˜¾ç¤ºçš„æ˜¯ <code>X-B3-*_NOT_FOUND</code></p>
<p>ç†è®ºä¸Šåº”è¯¥æ˜¯ <code>-</code> æˆ– <code></code>ï¼ˆç©ºï¼‰ï¼Œçœ‹æºç  <code>com.cwbase.logback.JSONEventLayout#mdcSubst</code> ï¼Œæ˜¯æ¡†æ¶è‡ªå·±æ²¡æœ‰è®¾ç½®é»˜è®¤å€¼çš„æ–¹æ³•</p>
<p>æ‰€ä»¥æš‚æ—¶å…ˆä¸å¤„ç†ï¼Œæˆ–ä»¥åæ”¹ç”¨ <code>FileAppender</code> + <code>logstash</code> çš„æ–¹å¼æ”¶é›†æ—¥å¿—</p>
</li>
</ul>
<h2 id="ç›¸å…³æ–‡æ¡£"><a href="#ç›¸å…³æ–‡æ¡£" class="headerlink" title="ç›¸å…³æ–‡æ¡£"></a>ç›¸å…³æ–‡æ¡£</h2><ul>
<li><p><a href="https://cloud.spring.io/spring-cloud-sleuth/1.3.x/single/spring-cloud-sleuth.html" target="_blank" rel="noopener">spring-cloud-sleuth Reference</a></p>
</li>
<li><p>spring-cloud-sleuth: <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-sleuth/1.3.4.RELEASE/single/spring-cloud-sleuth.html#__scheduled_annotated_methods" target="_blank" rel="noopener">scheduled_annotated_methods</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/6d6b52c7624f" target="_blank" rel="noopener">Spring Cloud Sleuthä½¿ç”¨ç®€ä»‹</a></p>
</li>
<li><p>Spring Cloud Sleuth does not add trace/span related headers to the Http Response for security reasons. If you need the headers, see: <a href="https://cloud.spring.io/spring-cloud-sleuth/1.3.x/single/spring-cloud-sleuth.html#_example" target="_blank" rel="noopener">åœ¨http response ä¸­æ·»åŠ  trace header</a></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€spring-cloudã€‘æœåŠ¡è°ƒç”¨è¿½è¸ª/" data-id="cjs2lii05000saxui7fyxxyor" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/spring-cloud/">spring-cloud</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€bootstrapã€‘file-input" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€bootstrapã€‘file-input/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€bootstrapã€‘file-input/">
                
                ã€bootstrapã€‘file-input
            </a>
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>æš‚æ—¶ä¸é€‚ç”¨è¯¥æ–¹å¼ä¸Šä¼ æ–‡ä»¶</p>
</blockquote>
<h1 id="æ–‡ä»¶ä¸Šä¼ æ’ä»¶"><a href="#æ–‡ä»¶ä¸Šä¼ æ’ä»¶" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ’ä»¶"></a>æ–‡ä»¶ä¸Šä¼ æ’ä»¶</h1><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="http://plugins.krajee.com/file-input" target="_blank" rel="noopener">fileinput</a></p>
<h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><ul>
<li><p>å¼•å…¥css</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"&lt;c:url value="</span>/<span class="attr">assets</span>/<span class="attr">bower_components</span>/<span class="attr">bootstrap-fileinput</span>/<span class="attr">css</span>/<span class="attr">fileinput.min.css</span>"/&gt;</span>"/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¼•å…¥js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;&lt;c:url value=&quot;/assets/bower_components/bootstrap-fileinput/js/fileinput.min.js&quot;/&gt;&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;&lt;c:url value=&quot;/assets/bower_components/bootstrap-fileinput/js/locales/zh.js&quot;/&gt;&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;&lt;c:url value=&quot;/assets/bower_components/bootstrap-fileinput/js/plugins/piexif.min.js&quot;/&gt;&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è¯¥æ’ä»¶éœ€è¦</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"f1"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">class</span>=<span class="string">"file"</span> <span class="attr">data-show-preview</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$scope.initFileinput(<span class="string">"#f1"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$scope.initFileinput = <span class="function"><span class="keyword">function</span> (<span class="params">fileinputId</span>) </span>&#123;</span><br><span class="line">    $(fileinputId).fileinput(&#123;</span><br><span class="line">        <span class="string">"uploadUrl"</span>: <span class="string">"/fileUpload/upload"</span>,</span><br><span class="line">        <span class="string">"maxFileSize"</span>: <span class="number">20480</span>,</span><br><span class="line">        <span class="string">"msgSizeTooLarge"</span>: <span class="string">"æ–‡ä»¶(&#123;name&#125; - &#123;size&#125; KB) è¶…è¿‡æœ€å¤§é™åˆ¶ &#123;maxSize&#125; KB. è¯·é‡æ–°ä¸Šä¼ !"</span></span><br><span class="line">    &#125;);</span><br><span class="line">    $(fileinputId).on(<span class="string">'fileuploaded'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event, data, previewId, index</span>) </span>&#123;</span><br><span class="line">        $scope.taskRequest.fileName = data.response.fileName;</span><br><span class="line">        $scope.taskRequest.fileUrl = data.response.path;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€bootstrapã€‘file-input/" data-id="cjs2lihzf0000axuipjj7xv8q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/bootstrap/">bootstrap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/fileinput/">fileinput</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€dockerã€‘æ€ä¸æ­»çš„docker" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€dockerã€‘æ€ä¸æ­»çš„docker/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€dockerã€‘æ€ä¸æ­»çš„docker/">
                
                ã€dockerã€‘æ€ä¸æ­»çš„docker
            </a>
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Cannot restart container oasis-roomservice: Cannot kill container 9f34690345ddc450f8dcb60ed72fd0ceba3a9ce5196ba14e0a9b8e346082280a: connection error: desc = â€œtransport: dial unix /var/run/docker/containerd/docker-containerd.sock: connect: connection refusedâ€: unknown</p>
<p>åº”è¯¥æ˜¯å†…å­˜ä¸è¶³å¯¼è‡´çš„</p>
<ul>
<li><a href="https://github.com/moby/moby/issues/36002" target="_blank" rel="noopener">https://github.com/moby/moby/issues/36002</a></li>
<li><a href="https://github.com/jwilder/nginx-proxy/issues/1034" target="_blank" rel="noopener">https://github.com/jwilder/nginx-proxy/issues/1034</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€dockerã€‘æ€ä¸æ­»çš„docker/" data-id="cjs2lihzo0004axuikc3cafmi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/docker/">docker</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€dockerã€‘åˆ›å»ºjavaå®¹å™¨" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€dockerã€‘åˆ›å»ºjavaå®¹å™¨/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€dockerã€‘åˆ›å»ºjavaå®¹å™¨/">
                
                ã€dockerã€‘åˆ›å»ºjavaå®¹å™¨
            </a>
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="åˆ›å»ºjreé•œåƒ"><a href="#åˆ›å»ºjreé•œåƒ" class="headerlink" title="åˆ›å»ºjreé•œåƒ"></a>åˆ›å»ºjreé•œåƒ</h2><ul>
<li>Dockerfile / jre8</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM daocloud.io/library/java:8u111-jre-alpine</span><br><span class="line">MAINTAINER 624498030@qq.com</span><br><span class="line">ARG DOCKER_HOST_IP</span><br><span class="line">ENV DOCKER_HOST_IP=$DOCKER_HOST_IP</span><br><span class="line">RUN echo &quot;docker host ip found1: $DOCKER_HOST_IP&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ„å»º oasis/java çš„é•œåƒ</li>
</ul>
<blockquote>
<p>å› ä¸ºconsulæœåŠ¡é‡Œè¦ç”¨åˆ°æœåŠ¡æœ¬èº«çš„å†…ç½‘IPï¼ˆåŒºåˆ«äºé•œåƒå†…éƒ¨IPï¼‰ï¼Œ<br>æ‰€ä»¥å•ç‹¬æ„å»ºäº† oasis/java çš„é•œåƒï¼Œå°†æœåŠ¡å™¨IPæ˜ å°„åˆ°å®¹å™¨å†…</p>
</blockquote>
<p>æŠŠæœ¬æœºå¤–ç½‘IPæ˜ å°„åˆ°é•œåƒå†…</p>
<p><code>docker build --tag=oasis/java:latest --build-arg DOCKER_HOST_IP=$(ifconfig eth0 | grep inet | awk &#39;{print $2}&#39;) .</code></p>
<h2 id="æ„å»ºå®¹å™¨"><a href="#æ„å»ºå®¹å™¨" class="headerlink" title="æ„å»ºå®¹å™¨"></a>æ„å»ºå®¹å™¨</h2><p>è‡ªè¡Œæ›¿æ¢</p>
<ul>
<li>${service-name} æœåŠ¡åç§°</li>
<li>${outer-port}:${inner-port} æœåŠ¡å™¨ç«¯å£:å®¹å™¨å†…ç«¯å£</li>
<li>${container-name} å®¹å™¨åå­—</li>
<li>${hotname} ä¸»æœºå</li>
<li>${project-name} é¡¹ç›®æ‰“åŒ…åçš„åå­—</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  $&#123;service-name&#125;:</span><br><span class="line">    image: oasis/java:latest</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;$&#123;outer-port&#125;:$&#123;inner-port&#125;&quot;</span><br><span class="line">      - &quot;$&#123;debug-port&#125;:$&#123;debug-port&#125;&quot;</span><br><span class="line">    container_name : $&#123;container-name&#125;</span><br><span class="line">    hostname: $&#123;hostname&#125;</span><br><span class="line">    mem_limit: 3000m</span><br><span class="line">    stdin_open: true</span><br><span class="line">    tty: true</span><br><span class="line">    working_dir: /opt/app</span><br><span class="line">    command: java -Dfile.encoding=UTF-8 -Duser.timezone=GMT+08 -Dspring.profiles.active=prod -jar -Xmx512M $&#123;project-name&#125;.jar</span><br><span class="line">    volumes:</span><br><span class="line">      - /data1/auto_upline/$&#123;project-name&#125;:/opt/app</span><br><span class="line">      - /etc/localtime:/etc/localtime:ro</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€dockerã€‘åˆ›å»ºjavaå®¹å™¨/" data-id="cjs2lihzp0005axuip6szc344" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/docker/">docker</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€guavaã€‘EventBus" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€guavaã€‘EventBus/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€guavaã€‘EventBus/">
                
                ã€guavaã€‘EventBus
            </a>
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="EventBus"><a href="#EventBus" class="headerlink" title="EventBus"></a>EventBus</h1><p>æ¶ˆæ¯æ€»çº¿, æœ›æ–‡ç”Ÿä¹‰, å‘å¸ƒè®¢é˜…è€…æ¨¡å¼ä¸­ç”¨æ¥åšäº‹ä»¶è°ƒåº¦çš„ç»„ä»¶</p>
<p>ä¸‹æ–‡åŸºæ–¼<code>guava-18.0</code></p>
<p>EventBus æ¯”è¼ƒå€¼å¾—å­¦ä¹ çš„æ˜¯:</p>
<ul>
<li><p>com.google.common.eventbus.EventBus#subscribersByType</p>
<blockquote>
<p>SetMultimap&lt;Class&lt;?&gt;, EventSubscriber&gt; subscribersByType</p>
</blockquote>
<p>ä»¥ event object ä½œä¸º key, method ä¸ºæ–¹æ³•</p>
<p>è¿™æ ·åœ¨æ¶ˆè´¹eventçš„æ—¶å€™, å¯ä»¥æ ¹æ® event object å¿«é€Ÿæ‰¾å‡ºæ‰€æœ‰çš„è®¢é˜…è€…æ–¹æ³•(@Subscribe)</p>
<p>æ³¨å†Œæ¶ˆè´¹è€…çš„æ–¹æ³•å¯ä»¥å€Ÿé‰´<br>-&gt; <code>com.google.common.eventbus.EventBus#register</code><br>-&gt; <code>com.google.common.collect.Multimap#putAll</code></p>
</li>
<li><p>AsyncEventBus</p>
<p>å¼‚æ­¥çš„æ¶ˆæ¯æ€»çº¿, å…¶å®å°±æ˜¯ç»§æ‰¿EventBusä¹‹åé‡å†™äº†3ä¸ªæ–¹æ³•:</p>
<ul>
<li><p>enqueueEvent: eventå…¥é˜Ÿåˆ—</p>
<ul>
<li>EventBus: ä½¿ç”¨ThreadLocaléš”ç¦»å¤šçº¿ç¨‹, æ¯ä¸ªçº¿ç¨‹è‡ªå·±å¤„ç†è‡ªå·±çš„event</li>
<li>AsyncEventBus: ä½¿ç”¨ConcurrentLinkedQueueè§£å†³å¹¶å‘, ä½¿å¾—ä»»åŠ¡è°ƒåº¦æ›´é«˜æ•ˆ</li>
</ul>
</li>
<li><p>dispatchQueuedEvents: è°ƒåº¦é˜Ÿåˆ—ä¸­çš„ event</p>
<p>å‡ ä¹æ²¡ä»€ä¹ˆåŒºåˆ«, éƒ½æ˜¯å¾ªç¯æ‹¿eventè¿›è¡Œè°ƒåº¦</p>
<ul>
<li>EventBus: è¿˜è¦ç”¨isDispatchingè®¾ç½®æ˜¯å¦æ­£åœ¨æ‰§è¡Œçš„å¼€å…³, æ„Ÿè§‰æœ‰ç‚¹é¸¡è‚‹</li>
</ul>
</li>
<li><p>dispatch: è°ƒåº¦æ–¹æ³•</p>
<ul>
<li>EventBus: åå°„è°ƒç”¨çœŸå®çš„è®¢é˜…è€…(<code>method.invoke(target, new Object[] { event })</code>)</li>
<li>AsyncEventBus: ä½¿ç”¨ Executor å¼‚æ­¥è°ƒåº¦: super.dispatch</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><p><a href="http://ifeve.com/google-guava-eventbus/" target="_blank" rel="noopener">[Google Guava] 11-äº‹ä»¶æ€»çº¿</a></p>
<p>å¾ˆå¥½çš„è§£é‡Šäº†:</p>
<ul>
<li>ä¸ºä»€ä¹ˆè¦ç”¨ EventBus</li>
<li>ä¸ºä»€ä¹ˆä½¿ç”¨ @Subscribe æ³¨è§£, è€Œä¸æ˜¯æ¥å£</li>
<li>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨æ³›å‹(spring event ä¸­å°±ç”¨çš„æ³›å‹), è€Œæ˜¯ Object</li>
</ul>
</li>
<li><p><a href="https://juejin.im/post/5b61c852e51d451956055476" target="_blank" rel="noopener">Guavaï¼šEventBus æºç åˆ†æ</a></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€guavaã€‘EventBus/" data-id="cjs2lihzq0007axui8k6jj1dg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/eventbus/">eventbus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/guava/">guava</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€feignã€‘ä¸æ”¯æŒåœ¨Getè¯·æ±‚ä¸­ä½¿ç”¨å¯¹è±¡ä¼ å‚" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€feignã€‘ä¸æ”¯æŒåœ¨Getè¯·æ±‚ä¸­ä½¿ç”¨å¯¹è±¡ä¼ å‚/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€feignã€‘ä¸æ”¯æŒåœ¨Getè¯·æ±‚ä¸­ä½¿ç”¨å¯¹è±¡ä¼ å‚/">
                
                ã€feignã€‘ä¸æ”¯æŒåœ¨Getè¯·æ±‚ä¸­ä½¿ç”¨å¯¹è±¡ä¼ å‚
            </a>
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>è§£å†³æ–¹æ³•ï¼š</p>
<ol>
<li><p>æ”¹ç”¨ POST</p>
</li>
<li><p>æ”¹ç”¨ Map</p>
</li>
<li><p>è‡ªå®šä¹‰ Encoder</p>
<ul>
<li>@see <a href="feign-request-object.md">feign-request-object</a></li>
<li>@see <a href="https://github.com/OpenFeign/feign/issues/520" target="_blank" rel="noopener">https://github.com/OpenFeign/feign/issues/520</a></li>
</ul>
</li>
</ol>
<h3 id="ä¸€ç‚¹å»¶ä¼¸"><a href="#ä¸€ç‚¹å»¶ä¼¸" class="headerlink" title="ä¸€ç‚¹å»¶ä¼¸"></a>ä¸€ç‚¹å»¶ä¼¸</h3><blockquote>
<p>quote: <a href="https://source.coveo.com/2016/07/21/feign-request-object/" target="_blank" rel="noopener">https://source.coveo.com/2016/07/21/feign-request-object/</a></p>
</blockquote>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">Using request objects with Feign</span><br><span class="line">BY JONATHAN ROCHETTE â€” JULY 21, 2016</span><br><span class="line">We recently decided to move our functional tests stack from python to Java, mainly to make coding them easier (our projectâ€™s backend is coded in Java) and thus increase the number of tests getting written. We needed a few things to make this possible and one of them was a complete and comprehensive Java client for the Usage Analytics API. Since a lot of the Java API clients we use internaly are built with Netflixâ€™s Feign, I decided to give it a go.</span><br><span class="line"></span><br><span class="line">After playing with Feign a little, I started to really like the tool. Writing an HTTP client with it is pretty easy, and it would not be a lot of work to maintain. I only had one major concern: there was no out of the box support for request objects.</span><br><span class="line"></span><br><span class="line">Using request objects is a simple pattern that help maintain methods with many optional parameters, which is the case for some our APIâ€™s methods. Without request objects, calling a method would look like this:</span><br><span class="line"></span><br><span class="line">statsApi.getCombinedData(from,</span><br><span class="line">                         to,</span><br><span class="line">                         dimensions,</span><br><span class="line">                         metrics,</span><br><span class="line">                         null,</span><br><span class="line">                         null,</span><br><span class="line">                         null,</span><br><span class="line">                         null,</span><br><span class="line">                         true,</span><br><span class="line">                         null,</span><br><span class="line">                         null,</span><br><span class="line">                         null);</span><br><span class="line">Not looking so good, right? Using a request object transforms the method call into this:</span><br><span class="line"></span><br><span class="line">statsApi.getCombinedData(new GetCombinedDataRequest(from,</span><br><span class="line">                                                    to,</span><br><span class="line">                                                    dimensions,</span><br><span class="line">                                                    metrics)</span><br><span class="line">                         .withIncludeMetadata(true));</span><br><span class="line">Way better!</span><br><span class="line"></span><br><span class="line">For the request objects, we settled for a constructor that would take the required parameters of the API call in arguments. The optional parameters can then be added to the request with setters or via the fluent interface pattern.</span><br><span class="line"></span><br><span class="line">So, this is all very nice, but it does not fix my initial concern with Feign. I have some really nice request objects, but I cannot use any of them, as they are not supported. But, since Feign is very easily extendable, I simply added support for the request objects via a homemade encoder. And thus, the ReflectionEncoder was born.</span><br><span class="line"></span><br><span class="line">public class ReflectionEncoder implements Encoder</span><br><span class="line">&#123;</span><br><span class="line">    private static final String DEFAULT_DATETIME_FORMAT = &quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSSZZ&quot;;</span><br><span class="line">    private ObjectMapper mapper;</span><br><span class="line">    private Encoder fallbackEncoder;</span><br><span class="line"></span><br><span class="line">    public ReflectionEncoder(ObjectMapper mapper,</span><br><span class="line">                             Encoder fallbackEncoder)</span><br><span class="line">    &#123;</span><br><span class="line">        this.mapper = mapper;</span><br><span class="line">        this.fallbackEncoder = fallbackEncoder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void encode(Object parametersObject, Type bodyType, RequestTemplate template)</span><br><span class="line">      throws EncodeException &#123;</span><br><span class="line">      if (Request.class.isAssignableFrom(parametersObject.getClass())) &#123;</span><br><span class="line">        Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();</span><br><span class="line">        try &#123;</span><br><span class="line">          // Prepare the requestTemplate</span><br><span class="line">          for (Method method : parametersObject.getClass().getMethods()) &#123;</span><br><span class="line">            if (method.isAnnotationPresent(QueryParam.class)) &#123;</span><br><span class="line">              String key = method.getAnnotation(QueryParam.class).value();</span><br><span class="line">              Object value = method.invoke(parametersObject);</span><br><span class="line">              if (value != null) &#123;</span><br><span class="line">                if (Collection.class.isAssignableFrom(method.getReturnType())) &#123;</span><br><span class="line">                  value =</span><br><span class="line">                      ((Collection&lt;?&gt;) value)</span><br><span class="line">                          .stream()</span><br><span class="line">                          .map(v -&gt; String.valueOf(v))</span><br><span class="line">                          .collect(Collectors.toList());</span><br><span class="line">                &#125; else if (DateTime.class.isAssignableFrom(method.getReturnType())) &#123;</span><br><span class="line">                  value = ((DateTime) value).toString(DEFAULT_DATETIME_FORMAT);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                  value = String.valueOf(value);</span><br><span class="line">                &#125;</span><br><span class="line">                params.put(key, value);</span><br><span class="line">                template.query(key, keyToTemplate(key));</span><br><span class="line">              &#125;</span><br><span class="line">            &#125; else if (method.isAnnotationPresent(PathParam.class)) &#123;</span><br><span class="line">              String key = method.getAnnotation(PathParam.class).value();</span><br><span class="line">              Object value = method.invoke(parametersObject);</span><br><span class="line">              if (value != null) &#123;</span><br><span class="line">                params.put(key, String.valueOf(value));</span><br><span class="line">              &#125;</span><br><span class="line">            &#125; else if (method.isAnnotationPresent(BodyParam.class)) &#123;</span><br><span class="line">              template.body(mapper.writeValueAsString(method.invoke(parametersObject)));</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          // Replace templates with actual values</span><br><span class="line">          template.resolve(params);</span><br><span class="line">        &#125; catch (</span><br><span class="line">            IllegalAccessException</span><br><span class="line">            | IllegalArgumentException</span><br><span class="line">            | InvocationTargetException</span><br><span class="line">            | JsonProcessingException e) &#123;</span><br><span class="line">          throw new EncodeException(&quot;Could not encode parameter object correctly&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        fallbackEncoder.encode(parametersObject, bodyType, template);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String keyToTemplate(String key)</span><br><span class="line">    &#123;</span><br><span class="line">        return &quot;&#123;&quot; + key + &quot;&#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">It may look complicated, but itâ€™s in fact pretty simple. Here is how it works: if the object received by the encoder is of the right type, it will use reflection to find the getters of the object, and depending on the annotation, inject the parameter at the right place in the RequestTemplate. Otherwise, it will use a fallback encoder.</span><br><span class="line"></span><br><span class="line">Now, simply set the ReflectionEncoder in your client class with the builder provided by Feign and you are ready to go!</span><br><span class="line"></span><br><span class="line">Here is a complete example of a simple client using request objects.</span><br><span class="line"></span><br><span class="line">public interface CustomDimensionsApi extends ClientFactory.Api</span><br><span class="line">&#123;</span><br><span class="line">    @RequestLine(&quot;PUT /&quot; + ApiVersion.VERSION + &quot;/dimensions/custom/&#123;apiName&#125;&quot;)</span><br><span class="line">    DimensionResponse editDimension(EditDimensionRequest request);</span><br><span class="line">&#125;</span><br><span class="line">public class EditDimensionRequest extends BaseRequest</span><br><span class="line">&#123;</span><br><span class="line">    private String apiName;</span><br><span class="line">    private Boolean updatePastEvents;</span><br><span class="line">    private CustomDimensionModel customDimensionModel;</span><br><span class="line"></span><br><span class="line">    public EditDimensionRequest(String apiName,</span><br><span class="line">                                CustomDimensionModel customDimensionModel)</span><br><span class="line">    &#123;</span><br><span class="line">        this.apiName = apiName;</span><br><span class="line">        this.customDimensionModel = customDimensionModel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PathParam(&quot;apiName&quot;)</span><br><span class="line">    public String getApiName() &#123; return apiName; &#125;</span><br><span class="line">    public void setApiName(String apiName) &#123; this.apiName = apiName; &#125;</span><br><span class="line"></span><br><span class="line">    @QueryParam(&quot;updatePastEvents&quot;)</span><br><span class="line">    public Boolean getUpdatePastEvents() &#123; return updatePastEvents; &#125;</span><br><span class="line">    public void setUpdatePastEvents(Boolean updatePastEvents) &#123; this.updatePastEvents = updatePastEvents; &#125;</span><br><span class="line"></span><br><span class="line">    @BodyParam</span><br><span class="line">    public CustomDimensionModel getCustomDimensionModel() &#123; return customDimensionModel; &#125;</span><br><span class="line">    public void setCustomDimensionModel(CustomDimensionModel customDimensionModel) &#123; this.customDimensionModel = customDimensionModel; &#125;</span><br><span class="line"></span><br><span class="line">    public EditDimensionRequest withUpdatePastEvents(Boolean updatePastEvents)&#123;</span><br><span class="line">        setUpdatePastEvents(updatePastEvents); return this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">There you have it: a very simple HTTP client built with Feign, using a request object. It made coding our functional tests way easier and made them much cleaner. The next steps for us would be to combine that with better exception handling (awesome post by my friend Jacques-Etienne Beaudet, go check it out) and we would be unstoppable!</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€feignã€‘ä¸æ”¯æŒåœ¨Getè¯·æ±‚ä¸­ä½¿ç”¨å¯¹è±¡ä¼ å‚/" data-id="cjs2lihzr0008axuihz7jf1h2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/feign/">feign</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/spring-cloud/">spring-cloud</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€hystrixã€‘æ¢ç´¢" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€hystrixã€‘æ¢ç´¢/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€hystrixã€‘æ¢ç´¢/">
                
                ã€hystrixã€‘æ¢ç´¢
            </a>
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="æ–­è·¯å™¨"><a href="#æ–­è·¯å™¨" class="headerlink" title="æ–­è·¯å™¨"></a>æ–­è·¯å™¨</h1><p>ä½œç”¨: é˜²æ­¢ä¸€ä¸ªæœåŠ¡æ¥å£é”™è¯¯å¯èƒ½ä¼šå¯¼è‡´çº§è”æ•…éšœ. </p>
<p>è§¦å‘æ¡ä»¶: å½“<strong>ä¸€ä¸ªå‘¨æœŸ</strong>å†…, å•ä¸ªæ¥å£è°ƒç”¨æ¬¡æ•°è¶…è¿‡<strong>è¯·æ±‚è°ƒç”¨é˜ˆå€¼</strong>, æˆ–å¤±è´¥ç‡è¾¾åˆ°<strong>å¤±è´¥ç™¾åˆ†æ¯”é˜ˆå€¼</strong>,<br>æ–­è·¯å™¨å°†ä¼šæ‰“å¼€, å¹¶ä¸”è¯·æ±‚ä¼šå¤±è´¥.</p>
<p>é™çº§: ä¸ºäº†é˜²æ­¢å¤±è´¥å’Œæ–­è·¯, å¼€å‘ä¸­å¯ä»¥æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°.<br>å›è°ƒå‡½æ•°å¯ä»¥æ˜¯å¦ä¸€ä¸ªå—Hystrixä¿æŠ¤çš„æ¥å£, é™æ€æ•°æ®æˆ–ç©ºå€¼. </p>
<p><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-netflix/1.4.x/docs/src/main/asciidoc/images/HystrixFallback.png" alt=""></p>
<h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><p>å¼•å…¥ä¾èµ–:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>å¯ç”¨:</p>
<p><code>@EnableCircuitBreaker</code></p>
<p>See <a href="https://github.com/Netflix/Hystrix/tree/master/hystrix-contrib/hystrix-javanica#configuration" target="_blank" rel="noopener">here</a> for more.</p>
<p>See the <a href="https://github.com/Netflix/Hystrix/wiki/Configuration" target="_blank" rel="noopener">Hystrix wiki</a> for details on the properties available.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€hystrixã€‘æ¢ç´¢/" data-id="cjs2lihzs000aaxuitxf9zs00" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ã€mgoã€‘mgoæºç è§£è¯»â€”â€”cluster" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€mgoã€‘mgoæºç è§£è¯»â€”â€”cluster/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€mgoã€‘mgoæºç è§£è¯»â€”â€”cluster/">
                
                ã€mgoã€‘mgoæºç è§£è¯»â€”â€”cluster
            </a>
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å®šæ—¶æ›´æ–°æœåŠ¡å™¨ä¿¡æ¯-â€”â€”-syncServersLoop"><a href="#å®šæ—¶æ›´æ–°æœåŠ¡å™¨ä¿¡æ¯-â€”â€”-syncServersLoop" class="headerlink" title="å®šæ—¶æ›´æ–°æœåŠ¡å™¨ä¿¡æ¯ â€”â€” syncServersLoop"></a>å®šæ—¶æ›´æ–°æœåŠ¡å™¨ä¿¡æ¯ â€”â€” syncServersLoop</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">// syncServersLoop loops while the cluster is alive to keep its idea of the server topology up-to-date.</span><br><span class="line">// å½“é›†ç¾¤å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œä»¥å¾ªç¯æ¥ä¿æŒæœåŠ¡çš„å®æ—¶æ‹“æ‰‘ç»“æ„ã€‚</span><br><span class="line"></span><br><span class="line">// It must be called just once from newCluster.</span><br><span class="line">// å¿…é¡»ä» newCluster è°ƒç”¨ä¸€æ¬¡ã€‚</span><br><span class="line"></span><br><span class="line">// The loop iterates once syncServersDelay has passed, or if somebody injects a value into the cluster.sync channel to force a synchronization.</span><br><span class="line">// ä¸€æ®µæ—¶é—´ï¼ˆsyncServersDelayï¼‰çš„å»¶è¿Ÿè¿‡åï¼Œå¾ªç¯ä¼šè¿›è¡Œä¸€æ¬¡è¿­ä»£ã€‚æˆ–è€…åœ¨ cluster.sync ç®¡é“ä¸­æ³¨å…¥ä¸€ä¸ªå€¼ï¼Œæ¥å¼ºåˆ¶æ‰§è¡Œä¸€æ¬¡åŒæ­¥æ“ä½œã€‚ï¼ˆä»æœ€åçš„selectç®¡é“é€šä¿¡å¯ä»¥å¾ˆå®¹æ˜“çœ‹å‡ºï¼‰</span><br><span class="line"></span><br><span class="line">// A loop iteration will contact all servers in parallel, ask them about known peers and their own role within the cluster, and then attempt to do the same with all the peers retrieved.</span><br><span class="line">// ä¸€æ¬¡å¾ªç¯è¿­ä»£å°†ä¼šâœ¨å¹¶è¡Œâœ¨è®¿é—®æ‰€æœ‰æœåŠ¡ï¼ŒæŸ¥è¯¢é›†ç¾¤ä¸­å·²çŸ¥çš„å¯¹ç­‰æœåŠ¡åŠè‡ªå·±çš„è§’è‰²ï¼Œç„¶åå¯¹æ‰€æœ‰å¯¹ç­‰æœåŠ¡å°è¯•åŒæ ·çš„æ“ä½œã€‚</span><br><span class="line"> </span><br><span class="line">func (cluster *mongoCluster) syncServersLoop() &#123;</span><br><span class="line">    // âœ¨ æ­»å¾ªç¯</span><br><span class="line">	for &#123;</span><br><span class="line">		debugf(&quot;SYNC Cluster %p is starting a sync loop iteration.&quot;, cluster)</span><br><span class="line"></span><br><span class="line">		// âœ¨ ä¸Šé”ï¼</span><br><span class="line">		cluster.Lock()</span><br><span class="line">		// âœ¨ é›†ç¾¤ä¸­æ²¡æœ‰æœåŠ¡äº†ï¼ˆå…¨æŒ‚äº†ï¼Ÿï¼‰</span><br><span class="line">		if cluster.references == 0 &#123;</span><br><span class="line">			cluster.Unlock()</span><br><span class="line">			break</span><br><span class="line">		&#125;</span><br><span class="line">		cluster.references++ // Keep alive while syncing.</span><br><span class="line">		// âœ¨ ï¼Ÿï¼Ÿï¼Ÿ</span><br><span class="line">		direct := cluster.direct</span><br><span class="line">		cluster.Unlock()</span><br><span class="line"></span><br><span class="line">		cluster.syncServersIteration(direct)</span><br><span class="line"></span><br><span class="line">		// We just synchronized, so consume any outstanding requests.</span><br><span class="line">		select &#123;</span><br><span class="line">		case &lt;-cluster.sync:</span><br><span class="line">		default:</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		cluster.Release()</span><br><span class="line"></span><br><span class="line">		// Hold off before allowing another sync. No point in</span><br><span class="line">		// burning CPU looking for down servers.</span><br><span class="line">		if !cluster.failFast &#123;</span><br><span class="line">			time.Sleep(syncShortDelay)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		cluster.Lock()</span><br><span class="line">		if cluster.references == 0 &#123;</span><br><span class="line">			cluster.Unlock()</span><br><span class="line">			break</span><br><span class="line">		&#125;</span><br><span class="line">		cluster.syncCount++</span><br><span class="line">		// Poke all waiters so they have a chance to timeout or</span><br><span class="line">		// restart syncing if they wish to.</span><br><span class="line">		cluster.serverSynced.Broadcast()</span><br><span class="line">		// Check if we have to restart immediately either way.</span><br><span class="line">		restart := !direct &amp;&amp; cluster.masters.Empty() || cluster.servers.Empty()</span><br><span class="line">		cluster.Unlock()</span><br><span class="line"></span><br><span class="line">		if restart &#123;</span><br><span class="line">			log(&quot;SYNC No masters found. Will synchronize again.&quot;)</span><br><span class="line">			time.Sleep(syncShortDelay)</span><br><span class="line">			continue</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		debugf(&quot;SYNC Cluster %p waiting for next requested or scheduled sync.&quot;, cluster)</span><br><span class="line"></span><br><span class="line">		// Hold off until somebody explicitly requests a synchronization</span><br><span class="line">		// or it&apos;s time to check for a cluster topology change again.</span><br><span class="line">		select &#123;</span><br><span class="line">		case &lt;-cluster.sync:</span><br><span class="line">		case &lt;-time.After(syncServersDelay):</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	debugf(&quot;SYNC Cluster %p is stopping its sync loop.&quot;, cluster)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="åŒæ­¥æœåŠ¡infoçš„æ ¸å¿ƒ"><a href="#åŒæ­¥æœåŠ¡infoçš„æ ¸å¿ƒ" class="headerlink" title="åŒæ­¥æœåŠ¡infoçš„æ ¸å¿ƒ"></a>åŒæ­¥æœåŠ¡infoçš„æ ¸å¿ƒ</h2><p>è®¾è®¡åˆ°çš„ç‚¹</p>
<ul>
<li>sync.WaitGroup å¹¶å‘æ§åˆ¶</li>
<li>sync.Mutex è¿™ä¸ªç®€å•</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">func (cluster *mongoCluster) syncServersIteration(direct bool) &#123;</span><br><span class="line">	log(&quot;SYNC Starting full topology synchronization...&quot;)</span><br><span class="line"></span><br><span class="line">	var wg sync.WaitGroup</span><br><span class="line">	var m sync.Mutex</span><br><span class="line">	notYetAdded := make(map[string]pendingAdd)</span><br><span class="line">	addIfFound := make(map[string]bool)</span><br><span class="line">	seen := make(map[string]bool)</span><br><span class="line">	syncKind := partialSync</span><br><span class="line"></span><br><span class="line">	var spawnSync func(addr string, byMaster bool)</span><br><span class="line">	spawnSync = func(addr string, byMaster bool) &#123;</span><br><span class="line">		// âœ¨ æ ‡è®°å¼€å¯äº†ä¸€ä¸ªæ–°çº¿ç¨‹</span><br><span class="line">		wg.Add(1)</span><br><span class="line">		go func() &#123;</span><br><span class="line">			defer wg.Done()</span><br><span class="line"></span><br><span class="line">			// âœ¨ è§£æåœ°å€ï¼Œè¿™ä¸ªresolveAddrå®ç°å¥½ğŸ‚ğŸºï¼Œè€ƒè™‘çš„è¾ƒå…¨é¢</span><br><span class="line">			// âœ¨ ï¼ˆä¸è¿›å»çœ‹ä»£ç äº†ï¼‰å…ˆè§£æipåœ°å€ï¼Œä¸æ˜¯ipåœ°å€å°±å½“åˆudpè¿æ¥è§£æï¼Œå› ä¸ºæ‹¨å·è¿æ¥å¯èƒ½è€—æ—¶ï¼Œç”¨äº†selectç®¡é“å¹¶å‘å¤„ç†ï¼Œè¿™é‡Œåˆ†åˆ«ä»¥udp4ã€udp6è¿›è¡Œå°è¯•</span><br><span class="line">			tcpaddr, err := resolveAddr(addr)</span><br><span class="line">			if err != nil &#123;</span><br><span class="line">				log(&quot;SYNC Failed to start sync of &quot;, addr, &quot;: &quot;, err.Error())</span><br><span class="line">				return</span><br><span class="line">			&#125;</span><br><span class="line">			resolvedAddr := tcpaddr.String()</span><br><span class="line"></span><br><span class="line">			// âœ¨ å·²å‘ç°åœ°å€çš„é€»è¾‘ï¼Œè¦åŠ é”</span><br><span class="line">			m.Lock()</span><br><span class="line">			if byMaster &#123;</span><br><span class="line">				if pending, ok := notYetAdded[resolvedAddr]; ok &#123;</span><br><span class="line">					delete(notYetAdded, resolvedAddr)</span><br><span class="line">					m.Unlock()</span><br><span class="line">					cluster.addServer(pending.server, pending.info, completeSync)</span><br><span class="line">					return</span><br><span class="line">				&#125;</span><br><span class="line">				addIfFound[resolvedAddr] = true</span><br><span class="line">			&#125;</span><br><span class="line">			// âœ¨ å¦‚æœå·²ç»å‘ç°è¯¥åœ°å€ï¼Œstop</span><br><span class="line">			if seen[resolvedAddr] &#123;</span><br><span class="line">				m.Unlock()</span><br><span class="line">				return</span><br><span class="line">			&#125;</span><br><span class="line">			// âœ¨ æ ‡è®°å½“å‰åœ°å€å·²è¢«å‘ç°</span><br><span class="line">			seen[resolvedAddr] = true</span><br><span class="line">			m.Unlock()</span><br><span class="line"></span><br><span class="line">			server := cluster.server(addr, tcpaddr)</span><br><span class="line">			// âœ¨ åŒæ­¥serverä¿¡æ¯</span><br><span class="line">			info, hosts, err := cluster.syncServer(server)</span><br><span class="line">			if err != nil &#123;</span><br><span class="line">				// âœ¨ åŒæ­¥ä¿¡æ¯å‡ºé”™ï¼Œç§»é™¤</span><br><span class="line">				cluster.removeServer(server)</span><br><span class="line">				return</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			m.Lock()</span><br><span class="line">			add := direct || info.Master || addIfFound[resolvedAddr]</span><br><span class="line">			if add &#123;</span><br><span class="line">				syncKind = completeSync</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				notYetAdded[resolvedAddr] = pendingAdd&#123;server, info&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			m.Unlock()</span><br><span class="line">			if add &#123;</span><br><span class="line">				cluster.addServer(server, info, completeSync)</span><br><span class="line">			&#125;</span><br><span class="line">			if !direct &#123;</span><br><span class="line">				for _, addr := range hosts &#123;</span><br><span class="line">					spawnSync(addr, info.Master)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	knownAddrs := cluster.getKnownAddrs()</span><br><span class="line">	for _, addr := range knownAddrs &#123;</span><br><span class="line">		spawnSync(addr, false)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line"></span><br><span class="line">	if syncKind == completeSync &#123;</span><br><span class="line">		logf(&quot;SYNC Synchronization was complete (got data from primary).&quot;)</span><br><span class="line">		for _, pending := range notYetAdded &#123;</span><br><span class="line">			cluster.removeServer(pending.server)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		logf(&quot;SYNC Synchronization was partial (cannot talk to primary).&quot;)</span><br><span class="line">		for _, pending := range notYetAdded &#123;</span><br><span class="line">			cluster.addServer(pending.server, pending.info, partialSync)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cluster.Lock()</span><br><span class="line">	mastersLen := cluster.masters.Len()</span><br><span class="line">	logf(&quot;SYNC Synchronization completed: %d master(s) and %d slave(s) alive.&quot;, mastersLen, cluster.servers.Len()-mastersLen)</span><br><span class="line"></span><br><span class="line">	// Update dynamic seeds, but only if we have any good servers. Otherwise,</span><br><span class="line">	// leave them alone for better chances of a successful sync in the future.</span><br><span class="line">	if syncKind == completeSync &#123;</span><br><span class="line">		dynaSeeds := make([]string, cluster.servers.Len())</span><br><span class="line">		for i, server := range cluster.servers.Slice() &#123;</span><br><span class="line">			dynaSeeds[i] = server.Addr</span><br><span class="line">		&#125;</span><br><span class="line">		cluster.dynaSeeds = dynaSeeds</span><br><span class="line">		debugf(&quot;SYNC New dynamic seeds: %#v\n&quot;, dynaSeeds)</span><br><span class="line">	&#125;</span><br><span class="line">	cluster.Unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€mgoã€‘mgoæºç è§£è¯»â€”â€”cluster/" data-id="cjs2lihzt000caxui0ui2m1f8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/golang/">golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/mgo/">mgo</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ã€mybatisã€‘é€šç”¨mapperæ³¨å†Œæµç¨‹" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/wiki/2018/11/05/ã€mybatisã€‘é€šç”¨mapperæ³¨å†Œæµç¨‹/" class="article-date">
  <time datetime="2018-11-05T07:11:52.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/2018/11/05/ã€mybatisã€‘é€šç”¨mapperæ³¨å†Œæµç¨‹/">
                
                ã€mybatisã€‘é€šç”¨mapperæ³¨å†Œæµç¨‹
            </a>
        </h1>
    

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a href="https://github.com/abel533/Mapper" target="_blank" rel="noopener">https://github.com/abel533/Mapper</a><br>/oasis-o2o/Mapper</p>
</blockquote>
<h2 id="é€šç”¨mapperæ³¨å†Œæµç¨‹"><a href="#é€šç”¨mapperæ³¨å†Œæµç¨‹" class="headerlink" title="é€šç”¨mapperæ³¨å†Œæµç¨‹"></a>é€šç”¨mapperæ³¨å†Œæµç¨‹</h2><p>ä½¿ç”¨å’±ä»¬è‡ªå·±çš„mapperæ‰©å±•æ’ä»¶æ—¶, æƒ³è‡ªå®šä¹‰mapperå®ç°æ‰¹é‡æ’å…¥(è§:InsertListMapper), å‘ç°æ— æ³•å®ä¾‹åŒ– <code>SpecialProvider</code>, </p>
<p><code>org.apache.ibatis.builder.BuilderException: Error invoking SqlProvider method</code></p>
<p>ç ”ç©¶å…¶mapperæ³¨å†Œæµç¨‹å‘ç°, åœ¨ <code>MapperScannerConfigurer</code> ä¸­æœªé…ç½® <code>mappers</code> æ—¶, é»˜è®¤æ³¨å†Œ <code>tk.mybatis.mapper.common.Mapper</code>, ä»£ç è§ <code>tk.mybatis.mapper.mapperhelper.MapperHelper#ifEmptyRegisterDefaultInterface</code>, å¦‚æœæŒ‡å®šäº† <code>mappers</code>, åˆ™åœ¨ <code>setProperties</code> æ—¶å°±å¼€å§‹æ³¨å†Œäº†, ä»£ç è§ <code>tk.mybatis.mapper.mapperhelper.MapperHelper#setProperties</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpcui.github.io/wiki/2018/11/05/ã€mybatisã€‘é€šç”¨mapperæ³¨å†Œæµç¨‹/" data-id="cjs2lihzw000faxui38wlvg7z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wiki/tags/mybatis/">mybatis</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/wiki/page/2/">2</a><a class="page-number" href="/wiki/page/3/">3</a><a class="page-number" href="/wiki/page/4/">4</a><a class="extend next" rel="next" href="/wiki/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/beego/">beego</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/bootstrap/">bootstrap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/consul/">consul</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/elastic-job/">elastic-job</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/eventbus/">eventbus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/feign/">feign</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/fileinput/">fileinput</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/golang/">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/guava/">guava</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/hikari/">hikari</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/mgo/">mgo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/mybatis/">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/spring/">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/spring-boot/">spring-boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/spring-cloud/">spring-cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/spring-data/">spring-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/æœåŠ¡æ¶æ„/">æœåŠ¡æ¶æ„</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wiki/tags/é¡¹ç›®ç®¡ç†/">é¡¹ç›®ç®¡ç†</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/wiki/tags/beego/" style="font-size: 10px;">beego</a> <a href="/wiki/tags/bootstrap/" style="font-size: 10px;">bootstrap</a> <a href="/wiki/tags/consul/" style="font-size: 10px;">consul</a> <a href="/wiki/tags/docker/" style="font-size: 12.5px;">docker</a> <a href="/wiki/tags/elastic-job/" style="font-size: 10px;">elastic-job</a> <a href="/wiki/tags/eventbus/" style="font-size: 10px;">eventbus</a> <a href="/wiki/tags/feign/" style="font-size: 10px;">feign</a> <a href="/wiki/tags/fileinput/" style="font-size: 10px;">fileinput</a> <a href="/wiki/tags/git/" style="font-size: 10px;">git</a> <a href="/wiki/tags/golang/" style="font-size: 12.5px;">golang</a> <a href="/wiki/tags/guava/" style="font-size: 10px;">guava</a> <a href="/wiki/tags/hikari/" style="font-size: 10px;">hikari</a> <a href="/wiki/tags/mgo/" style="font-size: 10px;">mgo</a> <a href="/wiki/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/wiki/tags/php/" style="font-size: 10px;">php</a> <a href="/wiki/tags/redis/" style="font-size: 10px;">redis</a> <a href="/wiki/tags/spring/" style="font-size: 10px;">spring</a> <a href="/wiki/tags/spring-boot/" style="font-size: 15px;">spring-boot</a> <a href="/wiki/tags/spring-cloud/" style="font-size: 20px;">spring-cloud</a> <a href="/wiki/tags/spring-data/" style="font-size: 10px;">spring-data</a> <a href="/wiki/tags/æœåŠ¡æ¶æ„/" style="font-size: 10px;">æœåŠ¡æ¶æ„</a> <a href="/wiki/tags/é¡¹ç›®ç®¡ç†/" style="font-size: 17.5px;">é¡¹ç›®ç®¡ç†</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/wiki/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/wiki/archives/2018/11/">November 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/wiki/2019/02/12/todolist/">todolist</a>
          </li>
        
          <li>
            <a href="/wiki/2018/11/05/ã€spring-bootã€‘application.properties/">ã€spring-bootã€‘application.properties</a>
          </li>
        
          <li>
            <a href="/wiki/2018/11/05/ã€bootstrapã€‘file-input/">ã€bootstrapã€‘file-input</a>
          </li>
        
          <li>
            <a href="/wiki/2018/11/05/ã€dockerã€‘æ€ä¸æ­»çš„docker/">ã€dockerã€‘æ€ä¸æ­»çš„docker</a>
          </li>
        
          <li>
            <a href="/wiki/2018/11/05/ã€dockerã€‘åˆ›å»ºjavaå®¹å™¨/">ã€dockerã€‘åˆ›å»ºjavaå®¹å™¨</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Sucre Cui<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/wiki/" class="mobile-nav-link">Home</a>
  
    <a href="/wiki/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/wiki/fancybox/jquery.fancybox.css">
  <script src="/wiki/fancybox/jquery.fancybox.pack.js"></script>


<script src="/wiki/js/script.js"></script>



  </div>
</body>
</html>